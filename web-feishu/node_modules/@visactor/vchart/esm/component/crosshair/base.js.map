{"version":3,"sources":["../src/component/crosshair/base.ts"],"names":[],"mappings":"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","file":"base.js","sourcesContent":["import type { Dict, IBoundsLike } from '@visactor/vutils';\n// eslint-disable-next-line no-duplicate-imports\nimport { throttle, PointService, isEqual, array, isArray, isNumber, get, isBoolean } from '@visactor/vutils';\nimport { RenderModeEnum } from '../../typings/spec/common';\nimport type { BaseEventParams, EventType } from '../../event/interface';\nimport type { IModelLayoutOption, IModelRenderOption } from '../../model/interface';\nimport type { IRegion } from '../../region/interface';\nimport { BaseComponent } from '../base/base-component';\nimport type { IPadding, Maybe, StringOrNumber } from '../../typings';\nimport { outOfBounds } from '../../util/math';\nimport type { IComponentOption } from '../interface';\nimport type {\n  ICrossHair,\n  CrossHairTrigger,\n  ICartesianCrosshairSpec,\n  IPolarCrosshairSpec,\n  ICrosshairCategoryFieldSpec\n} from './interface';\nimport { Event_Bubble_Level, Event_Source_Type, LayoutZIndex } from '../../constant';\nimport { getDefaultCrosshairTriggerEventByMode } from './config';\nimport type { IPolarAxis } from '../axis/polar/interface';\nimport type { IAxis } from '../axis/interface';\n\nexport type IBound = { x1: number; y1: number; x2: number; y2: number };\nexport type IAxisInfo<T> = Map<number, IBound & { axis: T }>;\n\nexport interface IHair {\n  /** 是否展示 crosshair 辅助图形 */\n  visible: boolean;\n  /** 类型 */\n  type: 'rect' | 'line';\n  /** 样式 */\n  style?: Dict<any>;\n  label?: {\n    /** 文本是否可见 */\n    visible: boolean;\n    /** 格式化函数 */\n    formatMethod?: (text: StringOrNumber | string[], position: string) => string | string[];\n    /** 文本样式 */\n    textStyle?: Dict<any>;\n    minWidth?: number;\n    maxWidth?: number;\n    padding?: IPadding | number | number[];\n    panel?: Dict<any>;\n    zIndex?: number;\n  };\n}\n\nconst ORIENT_MAP = {\n  x: ['top', 'bottom'],\n  y: ['left', 'right'],\n  category: ['angle'],\n  value: ['radius']\n};\n\nexport abstract class BaseCrossHair<T extends ICartesianCrosshairSpec | IPolarCrosshairSpec>\n  extends BaseComponent<T>\n  implements ICrossHair\n{\n  static specKey = 'crosshair';\n  specKey = 'crosshair';\n\n  layoutType: 'none' = 'none';\n  gridZIndex: number = LayoutZIndex.CrossHair_Grid;\n  labelZIndex: number = LayoutZIndex.CrossHair;\n  trigger: CrossHairTrigger = 'hover';\n  enable: boolean;\n  showDefault: boolean;\n  triggerOff: CrossHairTrigger | 'none' = 'hover'; // 为none则不消失\n\n  get enableRemain(): boolean {\n    return this.triggerOff === 'none';\n  }\n\n  private _limitBounds: Maybe<IBoundsLike>;\n\n  constructor(spec: T, options: IComponentOption) {\n    super(spec, options);\n    this.enable = true;\n    this.showDefault = true;\n  }\n\n  protected abstract _showDefaultCrosshairBySpec(): void;\n  protected abstract _layoutCrosshair(x: number, y: number): void;\n  protected abstract _parseFieldInfo(): void;\n  abstract hide(): void;\n\n  protected _getLimitBounds() {\n    if (!this._limitBounds) {\n      const { width, height } = this._option.globalInstance.getChart()?.getCanvasRect() ?? {\n        width: 0,\n        height: 0\n      };\n      this._limitBounds = {\n        x1: 0,\n        y1: 0,\n        x2: width,\n        y2: height\n      };\n    }\n    return this._limitBounds;\n  }\n\n  protected _showDefaultCrosshair() {\n    if (!this.showDefault) {\n      return;\n    }\n\n    this._showDefaultCrosshairBySpec();\n  }\n\n  setAttrFromSpec() {\n    super.setAttrFromSpec();\n    this._parseCrosshairSpec();\n  }\n\n  created() {\n    super.created();\n    // event\n    this._initEvent();\n  }\n\n  /**\n   * updateSpec\n   */\n  _compareSpec(spec: T, prevSpec: T) {\n    const result = super._compareSpec(spec, prevSpec);\n    if (!result.reMake && !isEqual(prevSpec, spec)) {\n      result.reRender = true;\n      result.reMake = true;\n    }\n    return result;\n  }\n\n  protected _initEvent() {\n    if (this._option.disableTriggerEvent) {\n      return;\n    }\n    const triggerConfig = this._getTriggerEvent();\n    if (triggerConfig) {\n      const { in: triggerEvent, out: outTriggerEvent } = triggerConfig;\n      array(triggerEvent).forEach((eventName, index) =>\n        this._registerEvent(eventName, isArray(outTriggerEvent) ? outTriggerEvent[index] : outTriggerEvent)\n      );\n    }\n  }\n\n  private _registerEvent(inEventName: EventType, outEventName: EventType) {\n    this.event.on(inEventName, { source: Event_Source_Type.chart }, this._handleEvent);\n    this.event.on(outEventName, { level: Event_Bubble_Level.chart }, (...arg: any) => {\n      if (this.enableRemain) {\n        return;\n      }\n      this.hide();\n    });\n  }\n\n  private _eventOff(eventName: EventType) {\n    this.event.off(eventName, this._handleEvent);\n  }\n\n  updateLayoutAttribute() {\n    this._limitBounds = null;\n    this._showDefaultCrosshair();\n  }\n\n  private _handleEvent = throttle((params: any) => {\n    if (!this._option) {\n      return;\n    }\n\n    const { event } = params as BaseEventParams;\n    // compute layer offset\n    const layer = this._option.getCompiler().getStage().getLayer(undefined);\n    const point = { x: event.viewX, y: event.viewY };\n    layer.globalTransMatrix.transformPoint({ x: event.viewX, y: event.viewY }, point);\n    const x = point.x - this.getLayoutStartPoint().x;\n    const y = point.y - this.getLayoutStartPoint().y;\n    this.showDefault = false;\n    this._layoutCrosshair(x, y);\n  }, 10);\n\n  private _getTriggerEvent() {\n    const { mode = RenderModeEnum['desktop-browser'] } = this._option;\n    const triggerConfig = getDefaultCrosshairTriggerEventByMode(mode);\n    if (triggerConfig) {\n      const trigger = this.trigger || 'hover';\n      const outTrigger = (trigger: CrossHairTrigger) => (trigger === 'click' ? 'clickOut' : 'hoverOut');\n      if (isArray(trigger)) {\n        // 同时配置了多个触发事件\n        let inResult: string[] = [];\n        let outResult: string[] = [];\n        trigger.forEach(item => {\n          inResult = inResult.concat(triggerConfig[item]);\n          outResult = outResult.concat(triggerConfig[outTrigger(item)]);\n        });\n        return {\n          in: inResult,\n          out: outResult\n        };\n      }\n      return {\n        in: triggerConfig[trigger],\n        out: triggerConfig[outTrigger(trigger)]\n      };\n    }\n    return null;\n  }\n\n  protected _getAxisInfoByField<T = IAxis>(field: 'x' | 'y' | 'category' | 'value') {\n    // 加判空防止某些特殊时刻（如 updateSpec 时）鼠标滑过图表导致报错\n    const axesComponents = this._option?.getComponentsByKey?.('axes') as IAxis[];\n    if (!axesComponents?.length) {\n      return null;\n    }\n    let bindingAxesIndex: number[] = get(this._spec, `${field}Field.bindingAxesIndex`);\n    if (!bindingAxesIndex) {\n      bindingAxesIndex = [];\n      axesComponents.forEach((item, index) => {\n        if (ORIENT_MAP[field].includes(item.getOrient())) {\n          bindingAxesIndex.push(index);\n        }\n      });\n    }\n    if (!bindingAxesIndex.length) {\n      return null;\n    }\n\n    const map: IAxisInfo<T> = new Map();\n    let x1 = Infinity;\n    let y1 = Infinity;\n    let x2 = -Infinity;\n    let y2 = -Infinity;\n    const { x: sx, y: sy } = this.getLayoutStartPoint();\n    bindingAxesIndex.forEach(idx => {\n      (x1 = Infinity), (y1 = Infinity), (x2 = -Infinity), (y2 = -Infinity);\n      const axis = axesComponents.find(axis => axis.getSpecIndex() === idx);\n      if (!axis) {\n        return;\n      }\n      const regions = axis.getRegions();\n      regions.forEach(r => {\n        const { x: regionStartX, y: regionStartY } = r.getLayoutStartPoint();\n        x1 = Math.min(x1, regionStartX - sx);\n        y1 = Math.min(y1, regionStartY - sy);\n        x2 = Math.max(x2, regionStartX + r.getLayoutRect().width - sx);\n        y2 = Math.max(y2, regionStartY + r.getLayoutRect().height - sy);\n      });\n      map.set(idx, { x1, y1, x2, y2, axis: axis as unknown as T });\n    });\n\n    return map;\n  }\n\n  changeRegions(regions: IRegion[]): void {\n    // do nothing\n  }\n\n  onLayoutEnd(ctx: IModelLayoutOption): void {\n    const region = this._regions[0];\n    this.setLayoutRect(region.getLayoutRect());\n    this.setLayoutStartPosition(region.getLayoutStartPoint());\n\n    super.onLayoutEnd(ctx);\n  }\n\n  onRender(ctx: IModelRenderOption): void {\n    // do nothing\n  }\n\n  protected _releaseEvent(): void {\n    const triggerConfig = this._getTriggerEvent();\n    if (triggerConfig) {\n      const { in: triggerEvent, out: outTriggerEvent } = triggerConfig;\n      if (isArray(triggerEvent)) {\n        triggerEvent.forEach(eachTriggerEvent => this._eventOff(eachTriggerEvent));\n      } else {\n        this._eventOff(triggerEvent);\n      }\n      if (isArray(outTriggerEvent)) {\n        outTriggerEvent.forEach(eachTriggerEvent => this._eventOff(eachTriggerEvent));\n      } else {\n        this._eventOff(outTriggerEvent);\n      }\n    }\n  }\n\n  protected _firstSeries<T>(): T | null {\n    for (let i = 0; i < this._regions.length; i++) {\n      const r = this._regions[i];\n      const series = r.getSeries();\n      for (let j = 0; j < series.length; j++) {\n        const s = series[j];\n        if (s) {\n          return s as unknown as T;\n        }\n      }\n    }\n    return null;\n  }\n\n  protected _parseCrosshairSpec() {\n    this._parseFieldInfo();\n\n    const { trigger, triggerOff, labelZIndex, gridZIndex } = this._spec;\n    if (trigger) {\n      this.trigger = trigger;\n    }\n    if (triggerOff) {\n      this.triggerOff = triggerOff;\n    } else {\n      this.triggerOff = this.trigger;\n    }\n    if (labelZIndex !== undefined) {\n      this.labelZIndex = labelZIndex;\n    }\n    if (gridZIndex !== undefined) {\n      this.gridZIndex = gridZIndex;\n    }\n  }\n\n  protected _parseField(field: ICrosshairCategoryFieldSpec, fieldName: string) {\n    const hair = {} as any;\n    const { line = {}, label = {}, visible } = field;\n    hair.visible = visible;\n    hair.type = line.type || 'line';\n    const style = line.style || {};\n    const { strokeOpacity, fillOpacity, opacity, stroke, fill, lineWidth, ...restStyle } = style as any;\n    const isLineType = hair.type === 'line';\n    let finalOpacity = isLineType ? strokeOpacity : fillOpacity;\n    if (isNumber(opacity)) {\n      finalOpacity = (finalOpacity ?? 1) * opacity;\n    }\n    hair.style =\n      line?.visible === false\n        ? { visible: false }\n        : {\n            opacity: finalOpacity,\n            pickable: false,\n            visible: true,\n            ...restStyle\n          };\n    if (isLineType) {\n      hair.style.stroke = stroke || fill;\n      hair.style.lineWidth = get(line, 'width', lineWidth || 2);\n    } else {\n      hair.style.fill = fill || stroke;\n      if (this._spec[fieldName]?.line?.style?.stroke) {\n        hair.style.stroke = this._spec[fieldName].line.style.stroke;\n      }\n      const rectSize = get(line, 'width');\n      if (typeof rectSize === 'string') {\n        const percent = parseInt(rectSize.substring(0, rectSize.length - 1), 10) / 100;\n        hair.style.sizePercent = percent;\n      } else if (typeof rectSize === 'number' || typeof rectSize === 'function') {\n        hair.style.size = rectSize;\n      }\n    }\n    const labelBackground = label.labelBackground || {};\n    const labelStyle = label.style || {};\n    const {\n      fill: rectFill = 'rgba(47, 59, 82, 0.9)',\n      stroke: rectStroke,\n      outerBorder,\n      ...rectStyle\n    } = labelBackground.style || {};\n    hair.label = !!label?.visible\n      ? {\n          visible: true,\n          formatMethod: label.formatMethod,\n          minWidth: labelBackground.minWidth,\n          maxWidth: labelBackground.maxWidth,\n          padding: labelBackground.padding,\n          textStyle: {\n            fontSize: 14,\n            pickable: false,\n            ...labelStyle,\n            fill: labelStyle.fill ?? '#fff',\n            stroke: get(labelStyle, 'stroke')\n          },\n          panel: (isBoolean(labelBackground?.visible) ? labelBackground?.visible : !!labelBackground)\n            ? {\n                visible: true,\n                pickable: false,\n                fill: rectFill,\n                stroke: rectStroke,\n                // Note: 通过这个配置可以保证 label 和 轴 label 对齐\n                outerBorder: {\n                  stroke: rectFill,\n                  distance: 0,\n                  lineWidth: 3,\n                  ...outerBorder\n                },\n                ...rectStyle\n              }\n            : { visible: false },\n          zIndex: this.labelZIndex,\n          childrenPickable: false,\n          pickable: false\n        }\n      : { visible: false };\n\n    return hair;\n  }\n\n  protected _filterAxisByPoint<T>(axisMap: IAxisInfo<T>, relativeX: number, relativeY: number) {\n    axisMap &&\n      axisMap.forEach(item => {\n        const axis = item.axis as unknown as IAxis | IPolarAxis;\n        if (outOfBounds(item, relativeX, relativeY)) {\n          axisMap.delete(axis.getSpecIndex());\n        }\n        if ((axis as IPolarAxis).type.startsWith('polarAxis')) {\n          // 极坐标下需要判断是否在半径内\n          const center = (axis as IPolarAxis).getCenter();\n          const innerRadius = (axis as IPolarAxis).getInnerRadius();\n          const outerRadius = (axis as IPolarAxis).getOuterRadius();\n          const distance = PointService.distancePP({ x: relativeX, y: relativeY }, center);\n          if (distance > outerRadius || distance < innerRadius) {\n            axisMap.delete((axis as IPolarAxis).getSpecIndex());\n          }\n        }\n      });\n    return axisMap;\n  }\n}\n"]}