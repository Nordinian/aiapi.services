"use strict";

Object.defineProperty(exports, "__esModule", {
    value: !0
}), exports.DataLabel = void 0;

const vutils_1 = require("@visactor/vutils"), base_1 = require("../core/base"), overlap_1 = require("./overlap"), rect_1 = require("./rect"), symbol_1 = require("./symbol"), arc_1 = require("./arc"), base_2 = require("./base"), line_data_1 = require("./line-data"), line_1 = require("./line"), area_1 = require("./area"), labelComponentMap = {
    rect: rect_1.RectLabel,
    symbol: symbol_1.SymbolLabel,
    arc: arc_1.ArcLabel,
    line: line_1.LineLabel,
    area: area_1.AreaLabel,
    "line-data": line_data_1.LineDataLabel
};

class DataLabel extends base_1.AbstractComponent {
    constructor(attributes, options) {
        super((null == options ? void 0 : options.skipDefault) ? attributes : (0, vutils_1.merge)({}, DataLabel.defaultAttributes, attributes)), 
        this.name = "data-label";
    }
    render() {
        var _a;
        const {dataLabels: dataLabels, size: size} = this.attribute;
        if (!dataLabels || 0 === dataLabels.length) return;
        const {width: width = 0, height: height = 0} = size || {};
        if (!width || !height || !(0, vutils_1.isValidNumber)(height * width)) return;
        this._componentMap || (this._componentMap = new Map);
        const tool = (0, overlap_1.bitmapTool)(width, height), bitmap = tool.bitmap(), currentComponentMap = new Map, prevComponentMap = this._componentMap;
        for (let i = 0; i < dataLabels.length; i++) {
            const dataLabel = dataLabels[i], labelComponent = labelComponentMap[dataLabel.type] || base_2.LabelBase;
            if (labelComponent) {
                const {baseMarkGroupName: baseMarkGroupName, type: type} = dataLabel, id = null !== (_a = dataLabel.id) && void 0 !== _a ? _a : `${baseMarkGroupName}-${type}-${i}`;
                let component = this._componentMap.get(id);
                component ? (component.setBitmapTool(tool), component.setBitmap(bitmap), component.setAttributes(dataLabel), 
                currentComponentMap.set(id, component)) : (component = new labelComponent(dataLabel), 
                component.setBitmap(bitmap), component.setBitmapTool(tool), this.add(component), 
                currentComponentMap.set(id, component));
            }
        }
        prevComponentMap.forEach(((cp, key) => {
            currentComponentMap.get(key) || this.removeChild(cp);
        })), this._componentMap = currentComponentMap;
    }
    setLocation(point) {
        this.translateTo(point.x, point.y);
    }
    disableAnimation() {
        this._componentMap.forEach((component => {
            component.disableAnimation();
        }));
    }
    enableAnimation() {
        this._componentMap.forEach((component => {
            component.enableAnimation();
        }));
    }
}

exports.DataLabel = DataLabel, DataLabel.defaultAttributes = {
    pickable: !1
};
//# sourceMappingURL=dataLabel.js.map