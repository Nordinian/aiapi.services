{"version":3,"sources":["../src/axis/grid/line.ts"],"names":[],"mappings":"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","file":"line.js","sourcesContent":["/**\n * @description 直线型坐标轴的网格线\n * - `type: 'line'` 用于直角坐标系下的坐标轴网格线绘制\n * - `type: 'circle'` 或者 `type: 'polygon'` 用于极坐标半径轴的网格线绘制\n */\nimport type { IPointLike } from '@visactor/vutils';\nimport { PointService, merge, polarToCartesian, mixin } from '@visactor/vutils';\nimport { BaseGrid } from './base';\nimport type {\n  GridItem,\n  LineAxisGridAttributes,\n  LineGridOfLineAxisAttributes,\n  PolarGridOfLineAxisAttributes\n} from './type';\nimport type { Point } from '../../core/type';\nimport { POLAR_START_ANGLE, POLAR_END_ANGLE } from '../../constant';\nimport type { TransformedAxisItem } from '../type';\nimport { LineAxisMixin } from '../mixin/line';\nimport type { ComponentOptions } from '../../interface';\nimport { loadLineAxisGridComponent } from '../register';\n\nfunction getCirclePoints(center: Point, count: number, radius: number, startAngle: number, endAngle: number) {\n  const points: Point[] = [];\n  const range = endAngle - startAngle;\n  for (let i = 0; i < count; i++) {\n    const angle = startAngle + (i * range) / count;\n    points.push(polarToCartesian(center, radius, angle));\n  }\n  return points;\n}\n\nexport interface LineAxisGrid\n  extends Pick<LineAxisMixin, 'isInValidValue' | 'getTickCoord' | 'getVerticalVector'>,\n    BaseGrid<LineAxisGridAttributes> {}\n\nloadLineAxisGridComponent();\nexport class LineAxisGrid extends BaseGrid<LineAxisGridAttributes> {\n  constructor(attributes: LineAxisGridAttributes, options?: ComponentOptions) {\n    super(options?.skipDefault ? attributes : merge({}, BaseGrid.defaultAttributes, attributes), options);\n  }\n\n  private _getGridPoint(gridType: string, point: IPointLike): Point[] {\n    let gridPoints;\n    if (gridType === 'line') {\n      const { length } = this.attribute as LineGridOfLineAxisAttributes;\n      const endPoint = this.getVerticalCoord(point, length as number, true);\n\n      gridPoints = [point, endPoint];\n    } else if (gridType === 'circle' || gridType === 'polygon') {\n      const {\n        center,\n        sides = 6,\n        startAngle = POLAR_START_ANGLE,\n        endAngle = POLAR_END_ANGLE\n      } = this.attribute as PolarGridOfLineAxisAttributes;\n      const distance = PointService.distancePP(center as Point, point);\n      gridPoints = getCirclePoints(center as Point, sides as number, distance, startAngle, endAngle);\n    }\n\n    return gridPoints;\n  }\n\n  protected getGridAttribute(isSubGrid: boolean) {\n    const { type: gridType, alignWithLabel = true } = this.attribute;\n\n    let tickSegment = 1;\n    const count = this.data.length;\n    if (count >= 2) {\n      tickSegment = this.data[1].value - this.data[0].value;\n    }\n    let gridAttribute;\n    let items: GridItem[] = [];\n    if (!isSubGrid) {\n      gridAttribute = this.attribute;\n      // 计算 grid Items\n      const gridItems: GridItem[] = [];\n      this.data.forEach(item => {\n        let { point } = item;\n\n        if (!alignWithLabel) {\n          // tickLine 不同 tick 对齐时需要调整 point\n          const value = item.value - tickSegment / 2;\n          if (this.isInValidValue(value)) {\n            return;\n          }\n          point = this.getTickCoord(value);\n        }\n\n        gridItems.push({\n          id: item.label,\n          datum: item,\n          points: this._getGridPoint(gridType, point)\n        });\n      });\n      items = gridItems;\n    } else {\n      // 渲染 subGrid\n      gridAttribute = merge({}, this.attribute, this.attribute.subGrid);\n      // 计算 grid Items\n      const subGridItems: GridItem[] = [];\n      const { count: subCount = 4 } = this.attribute.subGrid || {};\n      const tickLineCount = this.data.length;\n      // 刻度线的数量大于 2 时，才绘制子刻度\n      if (tickLineCount >= 2) {\n        const points: { value: number }[] = [];\n        this.data.forEach((item: TransformedAxisItem) => {\n          let tickValue = item.value;\n          if (!alignWithLabel) {\n            // tickLine 不同 tick 对齐时需要调整 point\n            const value = item.value - tickSegment / 2;\n            if (this.isInValidValue(value)) {\n              return;\n            }\n            tickValue = value;\n          }\n          points.push({\n            value: tickValue\n          });\n        });\n\n        for (let i = 0; i < points.length - 1; i++) {\n          const pre = points[i];\n          const next = points[i + 1];\n          subGridItems.push({\n            id: `sub-${i}-0`,\n            points: this._getGridPoint(gridType, this.getTickCoord(pre.value)),\n            // TODO: 其实这里也需要，后续需要考虑怎么挂上 data\n            datum: {}\n          });\n          for (let j = 0; j < subCount; j++) {\n            const percent = (j + 1) / (subCount + 1);\n            const value = (1 - percent) * pre.value + percent * next.value;\n            const point = this.getTickCoord(value);\n            subGridItems.push({\n              id: `sub-${i}-${j + 1}`,\n              points: this._getGridPoint(gridType, point),\n              // TODO: 其实这里也需要，后续需要考虑怎么挂上 data\n              datum: {}\n            });\n          }\n          if (i === points.length - 2) {\n            subGridItems.push({\n              id: `sub-${i}-${subCount + 1}`,\n              points: this._getGridPoint(gridType, this.getTickCoord(next.value)),\n              // TODO: 其实这里也需要，后续需要考虑怎么挂上 data\n              datum: {}\n            });\n          }\n        }\n        items = subGridItems;\n      }\n    }\n\n    return {\n      ...gridAttribute,\n      items\n    };\n  }\n}\n\nmixin(LineAxisGrid, LineAxisMixin);\n"]}