{"version":3,"sources":["../src/marker/base.ts"],"names":[],"mappings":"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","file":"base.js","sourcesContent":["import type { IGroup } from '@visactor/vrender-core';\nimport { graphicCreator } from '@visactor/vrender-core';\nimport { AbstractComponent } from '../core/base';\nimport type { Tag } from '../tag';\nimport type { MarkerAttrs } from './type';\n\nexport abstract class Marker<T extends MarkerAttrs> extends AbstractComponent<Required<T>> {\n  name = 'marker';\n  private _containerClip!: IGroup;\n  private _container!: IGroup;\n\n  protected _label!: Tag;\n\n  protected abstract setLabelPos(): any;\n  protected abstract initMarker(container: IGroup): any;\n  protected abstract updateMarker(): any;\n  protected abstract isValidPoints(): any;\n\n  setAttribute(key: keyof T, value: any, forceUpdateTag?: boolean | undefined): void {\n    super.setAttribute(key, value, forceUpdateTag);\n    if (key === 'visible') {\n      this.render();\n    }\n  }\n\n  private _initContainer() {\n    const { limitRect = {} as T['limitRect'], clipInRange } = this.attribute;\n    let group;\n    if (clipInRange) {\n      // 如果用户配置了剪切\n      const groupClip = graphicCreator.group({\n        ...limitRect,\n        clip: true,\n        pickable: false\n      });\n      group = graphicCreator.group({\n        x: -(limitRect.x ?? 0),\n        y: -(limitRect.y ?? 0),\n        pickable: false\n      });\n      groupClip.add(group);\n      this._containerClip = groupClip;\n      this.add(groupClip);\n    } else {\n      group = graphicCreator.group({\n        x: 0,\n        y: 0,\n        pickable: false\n      });\n      this.add(group);\n    }\n    group.name = 'marker-container';\n    this._container = group;\n  }\n\n  private _updateContainer() {\n    const { limitRect = {} as T['limitRect'], clipInRange } = this.attribute;\n    if (this._containerClip) {\n      this._containerClip.setAttributes({\n        ...limitRect\n      });\n    }\n\n    this._container.setAttributes({\n      x: clipInRange ? -(limitRect.x ?? 0) : 0,\n      y: clipInRange ? -(limitRect.y ?? 0) : 0\n    });\n  }\n\n  protected render() {\n    // 因为标注本身不规则，所以默认将组件的 group 设置为不可拾取\n    this.setAttribute('pickable', false);\n\n    const markerVisible = this.attribute.visible ?? true;\n    if (this.attribute.interactive === false) {\n      this.setAttribute('childrenPickable', false);\n    }\n\n    if (markerVisible && this.isValidPoints()) {\n      if (!this._container) {\n        this._initContainer();\n        this.initMarker(this._container);\n      } else {\n        this._updateContainer();\n        this.updateMarker();\n      }\n    } else {\n      this._container = null;\n      this.removeAllChild();\n    }\n  }\n}\n"]}