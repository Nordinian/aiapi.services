{"version":3,"sources":["../src/scrollbar/scrollbar-plugin.ts"],"names":[],"mappings":"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","file":"scrollbar-plugin.js","sourcesContent":["import type { IGraphic, IGroup, IPlugin, IPluginService } from '@visactor/vrender-core';\nimport { Generator, injectable } from '@visactor/vrender-core';\nimport { ScrollBar } from './scrollbar';\nimport type { IAABBBounds } from '@visactor/vutils';\nimport { AABBBounds, abs, max, min } from '@visactor/vutils';\n\n// _showPoptip: 0-没有，1-添加，2-删除\n\ntype IParams = {\n  timeout?: number; // 消失的timeout\n  bufferV?: number; // 判定是否出现滚动条的buffer\n  bufferH?: number; // 判定是否出现滚动条的buffer\n};\n\n@injectable()\nexport class ScrollBarPlugin implements IPlugin {\n  name: 'scrollbar' = 'scrollbar';\n  activeEvent: 'onRegister' = 'onRegister';\n  pluginService: IPluginService;\n  _uid: number = Generator.GenAutoIncrementId();\n  key: string = this.name + this._uid;\n  activeGraphic: IGraphic;\n  childrenBounds: IAABBBounds;\n  scrollContainerBounds: IAABBBounds;\n\n  static defaultParams: IParams = {\n    timeout: 500\n  };\n\n  params: IParams;\n\n  activate(context: IPluginService): void {\n    this.pluginService = context;\n    const { stage } = this.pluginService;\n\n    this.childrenBounds = new AABBBounds();\n    stage.addEventListener('wheel', this.scroll as any);\n    this.params = ScrollBarPlugin.defaultParams;\n  }\n  scroll = (e: { deltaX: number; deltaY: number; target: IGraphic }) => {\n    const graphic = e.target as any;\n    const data = this.getScrollContainer(graphic);\n    const { g: scrollContainer } = data;\n    let { showH, showV } = data;\n    if (!scrollContainer || scrollContainer.count === 1) {\n      return;\n    }\n    this.scrollContainerBounds = scrollContainer.AABBBounds.clone();\n    if (abs(e.deltaX) > abs(e.deltaY)) {\n      showH = showH && true;\n      showV = showV && false;\n    } else {\n      showH = showH && false;\n      showV = showV && true;\n    }\n    scrollContainer.setAttributes({\n      scrollX: showH ? (scrollContainer.attribute.scrollX || 0) + e.deltaX : scrollContainer.attribute.scrollX || 0,\n      scrollY: showV ? (scrollContainer.attribute.scrollY || 0) + e.deltaY : scrollContainer.attribute.scrollY || 0\n    });\n\n    // 计算子元素的bounds\n    const childrenBounds = this.childrenBounds;\n    const scrollContainerBounds = this.scrollContainerBounds;\n    childrenBounds.clear();\n    scrollContainer.forEachChildren((c: IGraphic) => {\n      childrenBounds.union(c.AABBBounds);\n    });\n    // 判断是否需要显示H或V，如果bounds完全在内部，那就不需要显示\n    childrenBounds.transformWithMatrix(scrollContainer.transMatrix);\n    if (showH && scrollContainerBounds.x1 <= childrenBounds.x1 && scrollContainerBounds.x2 >= childrenBounds.x2) {\n      showH = false;\n    }\n\n    if (showV && scrollContainerBounds.y1 <= childrenBounds.y1 && scrollContainerBounds.y2 >= childrenBounds.y2) {\n      showV = false;\n    }\n\n    // 转到当前坐标系下\n    const m = scrollContainer.transMatrix;\n    scrollContainerBounds.translate(-m.e, -m.f);\n    childrenBounds.translate(-m.e, -m.f);\n    // 如果子元素的bounds小于scrollContainer，那么就扩充\n    if (showH) {\n      childrenBounds.x1 = min(childrenBounds.x1, scrollContainerBounds.x1);\n      childrenBounds.x2 = max(childrenBounds.x2, scrollContainerBounds.x2);\n    }\n    if (showV) {\n      childrenBounds.y1 = min(childrenBounds.y1, scrollContainerBounds.y1);\n      childrenBounds.y2 = max(childrenBounds.y2, scrollContainerBounds.y2);\n    }\n    childrenBounds.translate(scrollContainer.attribute.scrollX, scrollContainer.attribute.scrollY);\n\n    const shadowRoot = scrollContainer.shadowRoot ?? scrollContainer.attachShadow();\n    const container = shadowRoot.createOrUpdateChild('scroll-bar', {}, 'group') as IGroup;\n    const { h, v, deltaH, deltaV } = this.addOrUpdateScroll(showH, showV, container, scrollContainer);\n    scrollContainer.setAttributes({\n      scrollX: h ? scrollContainer.attribute.scrollX || 0 : (scrollContainer.attribute.scrollX || 0) + deltaH,\n      scrollY: v ? scrollContainer.attribute.scrollY || 0 : (scrollContainer.attribute.scrollY || 0) + deltaV\n    });\n  };\n  addOrUpdateScroll(\n    showH: boolean,\n    showV: boolean,\n    container: IGroup,\n    scrollContainer: IGroup\n  ): { h: boolean; deltaH: number; v: boolean; deltaV: number } {\n    const scrollbars = container.children;\n    let h = false;\n    let v = false;\n    let deltaH = 0;\n    let deltaV = 0;\n    if (showH) {\n      const hScrollbar = scrollbars.filter((g: ScrollBar) => g.attribute.direction !== 'vertical')[0] as ScrollBar;\n      const d = this.addOrUpdateHScroll(this.scrollContainerBounds, container, hScrollbar);\n      h = d.valid;\n      deltaH = d.delta;\n      this.disappearScrollBar(hScrollbar, v);\n    }\n    if (showV) {\n      const vScrollbar = scrollbars.filter((g: ScrollBar) => g.attribute.direction === 'vertical')[0] as ScrollBar;\n      const d = this.addOrUpdateVScroll(this.scrollContainerBounds, container, vScrollbar);\n      v = d.valid;\n      deltaV = d.delta;\n      this.disappearScrollBar(vScrollbar, v);\n    }\n    return {\n      h,\n      deltaH,\n      v,\n      deltaV\n    };\n  }\n  addOrUpdateHScroll(\n    scrollContainerB: IAABBBounds,\n    container: IGroup,\n    scrollBar?: ScrollBar\n  ): { valid: boolean; delta: number } {\n    if (!scrollBar) {\n      scrollBar = new ScrollBar({\n        direction: 'horizontal',\n        x: 0,\n        y: 0,\n        width: scrollContainerB.width(),\n        height: 12,\n        padding: [2, 0],\n        railStyle: {\n          fill: 'rgba(0, 0, 0, .1)'\n        },\n        range: [0, 0.05]\n      });\n      container.add(scrollBar);\n    }\n    const b = scrollBar.AABBBounds;\n    const childrenBounds = this.childrenBounds;\n    const y = scrollContainerB.y2 - b.height();\n\n    const ratio = Math.min(b.width() / this.childrenBounds.width(), 1);\n    let start =\n      ((scrollContainerB.x1 - childrenBounds.x1) / (childrenBounds.width() - scrollContainerB.width())) * (1 - ratio);\n\n    let valid = true;\n    let delta = 0;\n    if (start < 0) {\n      start = 0;\n      valid = false;\n      delta = scrollContainerB.x1 - childrenBounds.x1;\n    } else if (start + ratio > 1) {\n      start = 1 - ratio;\n      valid = false;\n      delta = scrollContainerB.x1 - childrenBounds.x1 - (childrenBounds.width() - scrollContainerB.width());\n    }\n    scrollBar.setAttributes({\n      y,\n      visibleAll: true,\n      range: [start, start + ratio]\n    });\n    return {\n      valid,\n      delta\n    };\n  }\n\n  addOrUpdateVScroll(\n    scrollContainerB: IAABBBounds,\n    container: IGroup,\n    scrollBar?: ScrollBar\n  ): { valid: boolean; delta: number } {\n    if (!scrollBar) {\n      scrollBar = new ScrollBar({\n        direction: 'vertical',\n        x: 0,\n        y: 0,\n        width: 12,\n        height: scrollContainerB.height(),\n        padding: [2, 0],\n        railStyle: {\n          fill: 'rgba(0, 0, 0, .1)'\n        },\n        range: [0, 0.05]\n      });\n      container.add(scrollBar);\n    }\n    const b = scrollBar.AABBBounds;\n    const x = scrollContainerB.x2 - b.width();\n    const childrenBounds = this.childrenBounds;\n    const ratio = Math.min(b.height() / childrenBounds.height(), 1);\n    let start =\n      ((scrollContainerB.y1 - childrenBounds.y1) / (childrenBounds.height() - scrollContainerB.height())) * (1 - ratio);\n\n    let valid = true;\n    let delta = 0;\n    if (start < 0) {\n      start = 0;\n      valid = false;\n      delta = scrollContainerB.y1 - childrenBounds.y1;\n    } else if (start + ratio > 1) {\n      start = 1 - ratio;\n      valid = false;\n      delta = scrollContainerB.y1 - childrenBounds.y1 - (childrenBounds.height() - scrollContainerB.height());\n    }\n    scrollBar.setAttributes({\n      x,\n      visibleAll: true,\n      range: [start, start + ratio]\n    });\n    return {\n      valid,\n      delta\n    };\n  }\n\n  disappearScrollBar(scrollBar: ScrollBar, valid: boolean) {\n    if ((scrollBar as any)._plugin_timeout) {\n      clearTimeout((scrollBar as any)._plugin_timeout);\n    }\n    (scrollBar as any)._plugin_timeout = setTimeout(() => {\n      scrollBar.setAttribute('visibleAll', false);\n    }, this.params.timeout ?? 0);\n  }\n\n  // 获取响应滚动的元素\n  getScrollContainer(graphic: IGraphic): { g: IGroup; showH: boolean; showV: boolean } | null {\n    let g = graphic;\n    while (g) {\n      if (g.attribute.overflow && g.attribute.overflow !== 'hidden') {\n        const overflow = g.attribute.overflow;\n        let showH = false;\n        let showV = false;\n        if (overflow === 'scroll') {\n          (showH = true), (showV = true);\n        } else {\n          showH = overflow === 'scroll-x';\n          showV = !showH;\n        }\n        return { g: g as IGroup, showH, showV };\n      }\n      g = g.parent;\n    }\n    return null;\n  }\n\n  deactivate(context: IPluginService): void {\n    const { stage } = this.pluginService;\n    stage.removeEventListener('wheel', this.scroll as any);\n  }\n}\n"]}