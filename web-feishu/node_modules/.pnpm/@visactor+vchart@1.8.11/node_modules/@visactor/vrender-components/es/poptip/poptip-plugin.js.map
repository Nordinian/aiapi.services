{"version":3,"sources":["../src/poptip/poptip-plugin.ts"],"names":[],"mappings":"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","file":"poptip-plugin.js","sourcesContent":["import type { FederatedPointerEvent, IGraphic, IPlugin, IPluginService } from '@visactor/vrender-core';\nimport { Generator, injectable } from '@visactor/vrender-core';\n\n// _showPoptip: 0-没有，1-添加，2-删除\n\n@injectable()\nexport class PopTipPlugin implements IPlugin {\n  name: 'poptip' = 'poptip';\n  activeEvent: 'onRegister' = 'onRegister';\n  pluginService: IPluginService;\n  _uid: number = Generator.GenAutoIncrementId();\n  key: string = this.name + this._uid;\n  activeGraphic: IGraphic;\n\n  activate(context: IPluginService): void {\n    this.pluginService = context;\n    const { stage } = this.pluginService;\n\n    stage.addEventListener('pointerover', this.poptip);\n  }\n  poptip = (e: FederatedPointerEvent) => {\n    const graphic = e.target as any;\n    if (graphic.isContainer || !graphic.attribute) {\n      this.unpoptip(e);\n      return;\n    }\n    // 触发graphic重绘\n    if (graphic === this.activeGraphic) {\n      return;\n    }\n    const { poptip } = graphic.attribute;\n    if (poptip) {\n      graphic.setAttributes({});\n      graphic._showPoptip = 1;\n    }\n\n    if (this.activeGraphic) {\n      this.activeGraphic.setAttributes({});\n      this.activeGraphic._showPoptip = 2;\n    }\n    // console.log(graphic)\n    this.setActiveGraphic(graphic, true);\n  };\n\n  unpoptip = (e: FederatedPointerEvent) => {\n    if (!this.activeGraphic) {\n      return;\n    }\n    this.activeGraphic.setAttributes({});\n    this.activeGraphic._showPoptip = 2;\n    this.setActiveGraphic(null, true);\n  };\n\n  setActiveGraphic(graphic: any | null, rerender?: boolean) {\n    this.activeGraphic = graphic;\n    // 触发重绘\n    this.pluginService.stage.renderNextFrame();\n  }\n\n  deactivate(context: IPluginService): void {\n    const { stage } = this.pluginService;\n    stage.removeEventListener('pointerover', this.poptip);\n  }\n}\n\n@injectable()\nexport class PopTipForClipedTextPlugin implements IPlugin {\n  name: 'poptipForText' = 'poptipForText';\n  activeEvent: 'onRegister' = 'onRegister';\n  pluginService: IPluginService;\n  _uid: number = Generator.GenAutoIncrementId();\n  key: string = this.name + this._uid;\n  activeGraphic: IGraphic;\n\n  activate(context: IPluginService): void {\n    this.pluginService = context;\n    const { stage } = this.pluginService;\n\n    stage.addEventListener('pointerover', this.poptip);\n    stage.addEventListener('pointerleave', this.pointerlave);\n  }\n  pointerlave = (e: any) => {\n    const { stage } = this.pluginService;\n    if (e.target === stage) {\n      this.unpoptip(e);\n    }\n  };\n  poptip = (e: FederatedPointerEvent) => {\n    const graphic = e.target as any;\n    if (\n      graphic.type !== 'text' ||\n      !graphic.cliped ||\n      graphic.isContainer ||\n      !graphic.attribute ||\n      graphic.attribute.disableAutoClipedPoptip\n    ) {\n      this.unpoptip(e);\n      return;\n    }\n    // 触发graphic重绘\n    if (graphic === this.activeGraphic) {\n      return;\n    }\n    const { poptip = {} } = graphic.attribute;\n    if (poptip) {\n      graphic.setAttributes({});\n      graphic._showPoptip = 1;\n    }\n    // 添加默认poptip\n    if (this.activeGraphic) {\n      this.activeGraphic.setAttributes({});\n      this.activeGraphic._showPoptip = 2;\n    }\n    // console.log(graphic)\n    this.setActiveGraphic(graphic, true);\n  };\n\n  unpoptip = (e: FederatedPointerEvent) => {\n    if (!this.activeGraphic) {\n      return;\n    }\n    this.activeGraphic.setAttributes({});\n    this.activeGraphic._showPoptip = 2;\n    this.setActiveGraphic(null, true);\n  };\n\n  setActiveGraphic(graphic: any | null, rerender?: boolean) {\n    this.activeGraphic = graphic;\n    // 触发重绘\n    this.pluginService.stage.renderNextFrame();\n  }\n\n  deactivate(context: IPluginService): void {\n    const { stage } = this.pluginService;\n    stage.removeEventListener('pointerover', this.poptip);\n    stage.removeEventListener('pointerleave', this.pointerlave);\n  }\n}\n"]}