{"version":3,"sources":["../src/marker/point.ts"],"names":[],"mappings":"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","file":"point.js","sourcesContent":["import type {\n  IGroup,\n  IImage,\n  INode,\n  ISymbol,\n  IImageGraphicAttribute,\n  IRichText,\n  IRichTextGraphicAttribute,\n  ILine,\n  ILineGraphicAttribute\n} from '@visactor/vrender-core';\n// eslint-disable-next-line no-duplicate-imports\nimport { graphicCreator } from '@visactor/vrender-core';\nimport type { IPointLike } from '@visactor/vutils';\n// eslint-disable-next-line no-duplicate-imports\nimport { isValidNumber, merge } from '@visactor/vutils';\nimport { Segment } from '../segment';\nimport type { TagAttributes } from '../tag';\n// eslint-disable-next-line no-duplicate-imports\nimport { Tag } from '../tag';\nimport { Marker } from './base';\nimport { DEFAULT_MARK_POINT_TEXT_STYLE_MAP, DEFAULT_MARK_POINT_THEME } from './config';\nimport type { IItemContent, IItemLine, MarkPointAttrs } from './type';\n// eslint-disable-next-line no-duplicate-imports\nimport { IMarkPointItemPosition } from './type';\nimport type { Point } from '../core/type';\nimport type { ComponentOptions } from '../interface';\nimport { loadMarkPointComponent } from './register';\nimport { computeOffsetForlimit } from '../util/limit-shape';\n\nloadMarkPointComponent();\nexport class MarkPoint extends Marker<MarkPointAttrs> {\n  name = 'markPoint';\n  static defaultAttributes = DEFAULT_MARK_POINT_THEME;\n\n  private _item!: ISymbol | Tag | IImage | IRichText;\n\n  private _line?: Segment;\n\n  private _decorativeLine!: ILine;\n\n  constructor(attributes: MarkPointAttrs, options?: ComponentOptions) {\n    super(options?.skipDefault ? attributes : merge({}, MarkPoint.defaultAttributes, attributes));\n  }\n\n  protected setLabelPos() {\n    //do nothing\n  }\n\n  protected setItemAttributes(\n    item: ISymbol | Tag | IImage | IRichText,\n    itemContent: IItemContent,\n    itemPosition: Point,\n    itemType: 'symbol' | 'text' | 'image' | 'richText' | 'custom'\n  ) {\n    if (!item) {\n      return;\n    }\n    const {\n      autoRotate = true,\n      refX = 0,\n      refY = 0,\n      refAngle = 0,\n      textStyle = {},\n      richTextStyle = {},\n      imageStyle = {},\n      position = IMarkPointItemPosition.middle\n    } = itemContent;\n    const itemAngle = this._line?.getEndAngle() || 0;\n    const itemOffsetX = refX * Math.cos(itemAngle) + refY * Math.cos(itemAngle - Math.PI / 2);\n    const itemOffsetY = refX * Math.sin(itemAngle) + refY * Math.sin(itemAngle - Math.PI / 2);\n    if (itemType === 'text') {\n      item.setAttributes({\n        ...(textStyle as TagAttributes),\n        textStyle: {\n          ...DEFAULT_MARK_POINT_TEXT_STYLE_MAP[itemContent?.position || 'end'],\n          ...textStyle.textStyle\n        }\n      });\n    } else if (itemType === 'richText') {\n      item.setAttributes({\n        dx: this.getItemDx(item, position, richTextStyle) + (richTextStyle.dx || 0),\n        dy: this.getItemDy(item, position, richTextStyle) + (richTextStyle.dy || 0)\n      });\n    } else if (itemType === 'image') {\n      item.setAttributes({\n        dx: this.getItemDx(item, position, imageStyle) + (imageStyle.dx || 0),\n        dy: this.getItemDy(item, position, imageStyle) + (imageStyle.dy || 0)\n      });\n    }\n    item.setAttributes({\n      x: itemPosition.x + (itemOffsetX || 0),\n      y: itemPosition.y + (itemOffsetY || 0),\n      angle: autoRotate && itemAngle + refAngle\n    });\n  }\n\n  protected getItemDx(\n    item: ISymbol | Tag | IImage | IRichText,\n    position: keyof typeof IMarkPointItemPosition,\n    style?: IImageGraphicAttribute | IRichTextGraphicAttribute\n  ) {\n    const width = (item as IGroup)?.AABBBounds?.width() ?? (style?.width || 0);\n    if (position.includes('inside')) {\n      return -width;\n    }\n    if (position === 'insideTop') {\n      return 0;\n    }\n    return 0;\n  }\n\n  protected getItemDy(\n    item: ISymbol | Tag | IImage | IRichText,\n    position: keyof typeof IMarkPointItemPosition,\n    style?: IImageGraphicAttribute | IRichTextGraphicAttribute\n  ) {\n    const height = (item as IGroup)?.AABBBounds?.height() ?? (style?.height || 0);\n    if (position.includes('top') || position.includes('Top')) {\n      return -height;\n    }\n    if (position.includes('middle') || position.includes('Middle')) {\n      return -height / 2;\n    }\n    return 0;\n  }\n\n  protected initItem(itemContent: IItemContent, itemPosition: Point) {\n    const { type = 'text', symbolStyle, richTextStyle, imageStyle, renderCustomCallback } = itemContent;\n    let item: ISymbol | Tag | IImage | IRichText | IGroup;\n    if (type === 'symbol') {\n      item = graphicCreator.symbol({\n        ...itemPosition,\n        ...symbolStyle\n      });\n    } else if (type === 'text') {\n      item = new Tag({\n        ...itemPosition\n      });\n    } else if (type === 'richText') {\n      item = graphicCreator.richtext({\n        ...itemPosition,\n        ...richTextStyle\n      });\n    } else if (type === 'image') {\n      item = graphicCreator.image({\n        ...itemPosition,\n        ...imageStyle\n      });\n    } else if (type === 'custom' && renderCustomCallback) {\n      item = renderCustomCallback();\n    }\n    this.setItemAttributes(item, itemContent, itemPosition, type);\n    return item;\n  }\n\n  protected getItemLineAttr(itemLine: IItemLine, position: Point, itemPosition: Point) {\n    let points: Point[] = [];\n    const { type = 'type-s' } = itemLine;\n    if (type === 'type-do') {\n      points = [\n        position,\n        {\n          x: (position.x + itemPosition.x) / 2,\n          y: itemPosition.y\n        },\n        itemPosition\n      ];\n    } else if (type === 'type-po') {\n      points = [\n        position,\n        {\n          x: itemPosition.x,\n          y: position.y\n        },\n        itemPosition\n      ];\n    } else if (type === 'type-op') {\n      points = [\n        position,\n        {\n          x: position.x,\n          y: itemPosition.y\n        },\n        itemPosition\n      ];\n    } else {\n      points = [position, itemPosition];\n    }\n    return points;\n  }\n\n  protected setItemLineAttr(itemLine: IItemLine, position: Point, itemPosition: Point, visible: boolean) {\n    if (this._line) {\n      const { startSymbol, endSymbol, lineStyle } = itemLine;\n      const points = this.getItemLineAttr(itemLine, position, itemPosition);\n      this._line.setAttributes({\n        points,\n        startSymbol,\n        endSymbol,\n        lineStyle,\n        visible\n      });\n    }\n  }\n\n  protected getDecorativeLineAttr(itemLine: IItemLine, itemPosition: Point) {\n    const decorativeLength = itemLine?.decorativeLine?.length || 10;\n    const itemAngle = this._line.getEndAngle() || 0;\n    const startPointOffsetX = (decorativeLength / 2) * Math.cos(itemAngle - Math.PI / 2);\n    const startPointOffsetY = (decorativeLength / 2) * Math.sin(itemAngle - Math.PI / 2);\n    const endPointOffsetX = (-decorativeLength / 2) * Math.cos(itemAngle - Math.PI / 2);\n    const endPointOffsetY = (-decorativeLength / 2) * Math.sin(itemAngle - Math.PI / 2);\n    return {\n      startPointOffsetX,\n      startPointOffsetY,\n      endPointOffsetX,\n      endPointOffsetY\n    };\n  }\n\n  protected setDecorativeLineAttr(itemLine: IItemLine, itemPosition: Point, visible: boolean) {\n    if (this._decorativeLine) {\n      const { lineStyle } = itemLine;\n      const { startPointOffsetX, startPointOffsetY, endPointOffsetX, endPointOffsetY } = this.getDecorativeLineAttr(\n        itemLine,\n        itemPosition\n      );\n      this._decorativeLine.setAttributes({\n        points: [\n          {\n            x: itemPosition.x + startPointOffsetX,\n            y: itemPosition.y + startPointOffsetY\n          },\n          {\n            x: itemPosition.x + endPointOffsetX,\n            y: itemPosition.y + endPointOffsetY\n          }\n        ] as IPointLike[],\n        ...(lineStyle as Partial<ILineGraphicAttribute>),\n        visible\n      });\n    }\n  }\n\n  protected setAllOfItemsAttr(itemPosition: Point) {\n    const { position, itemLine = {}, itemContent = {}, limitRect } = this.attribute as MarkPointAttrs;\n    const { type = 'text', confine } = itemContent;\n    if (limitRect && confine) {\n      const { x, y, width, height } = limitRect;\n      const { dx, dy } = computeOffsetForlimit(this._item, {\n        x1: x,\n        y1: y,\n        x2: x + width,\n        y2: y + height\n      });\n      itemPosition.x = itemPosition.x + dx;\n      itemPosition.y = itemPosition.y + dy;\n    }\n    this.setItemAttributes(this._item, itemContent, itemPosition, type);\n    this.setItemLineAttr(itemLine, position, itemPosition, itemLine.visible);\n    this.setDecorativeLineAttr(itemLine, itemPosition, itemLine.decorativeLine?.visible);\n  }\n\n  protected initMarker(container: IGroup) {\n    const { position, itemContent = {} } = this.attribute as MarkPointAttrs;\n    const itemPosition = {\n      x: position.x + (itemContent.offsetX || 0),\n      y: position.y + (itemContent.offsetY || 0)\n    };\n\n    const line = new Segment({\n      points: [],\n      pickable: false // 组件容器本身不参与拾取\n    });\n    line.name = 'mark-point-line';\n    this._line = line;\n    container.add(line as unknown as INode);\n\n    const decorativeLine = graphicCreator.line({\n      points: []\n    });\n    decorativeLine.name = 'mark-point-decorativeLine';\n    this._decorativeLine = decorativeLine;\n    container.add(decorativeLine as unknown as INode);\n\n    // 为了强制将itemContent限制在limitRect内, 所以需要先绘制item, 然后根据item bounds 动态调整位置\n    const item = this.initItem(itemContent as any, itemPosition);\n    this._item = item;\n\n    // 由于itemLine的指向也要变化, 所以需要对所有的内容进行渲染\n    this.setAllOfItemsAttr(itemPosition);\n    container.add(item as unknown as INode);\n  }\n\n  protected updateMarker() {\n    const { position, itemContent = {} } = this.attribute as MarkPointAttrs;\n    const { type = 'text' } = itemContent;\n\n    const itemPosition = {\n      x: position.x + (itemContent.offsetX || 0),\n      y: position.y + (itemContent.offsetY || 0)\n    };\n\n    // 为了强制将itemContent限制在limitRect内, 所以需要先绘制item, 然后根据item bounds 动态调整位置\n    this.setItemAttributes(this._item, itemContent, itemPosition, type);\n    // 由于itemLine的指向也要变化, 所以需要对所有的内容进行渲染\n    this.setAllOfItemsAttr(itemPosition);\n  }\n\n  protected isValidPoints() {\n    const { position } = this.attribute as MarkPointAttrs;\n    if (isValidNumber(position.x) && isValidNumber(position.y)) {\n      return true;\n    }\n    return false;\n  }\n}\n"]}