{"version":3,"sources":["../src/component/data-zoom/scroll-bar/scroll-bar.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,OAAO,EAAE,SAAS,EAAE,OAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,OAAO,EAAE,MAAM,kBAAkB,CAAC;AAGzF,OAAO,EAAE,iBAAiB,EAAE,MAAM,sBAAsB,CAAC;AACzD,OAAO,EAAE,uBAAuB,EAAE,MAAM,+BAA+B,CAAC;AAGxE,OAAO,EAAE,SAAS,IAAI,kBAAkB,EAAE,MAAM,8BAA8B,CAAC;AAC/E,OAAO,EAAE,kBAAkB,EAAE,MAAM,qBAAqB,CAAC;AAEzD,OAAO,EAAE,UAAU,EAAE,WAAW,EAAE,YAAY,EAAE,MAAM,mBAAmB,CAAC;AAC1E,OAAO,EAAE,uBAAuB,EAAE,MAAM,8BAA8B,CAAC;AAGvE,OAAO,EAAE,OAAO,EAAE,MAAM,uBAAuB,CAAC;AAKhD,MAAM,OAAO,SAAqD,SAAQ,uBAA0B;IAelG,MAAM,CAAC,WAAW,CAAC,SAAc;QAC/B,MAAM,QAAQ,GAAG,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACzC,IAAI,KAAK,CAAC,QAAQ,CAAC,EAAE;YACnB,OAAO,SAAS,CAAC;SAClB;QACD,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE;YACtB,OAAO;gBACL;oBACE,IAAI,EAAE,QAAQ;oBACd,QAAQ,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC;oBACxB,IAAI,EAAE,iBAAiB,CAAC,SAAS;iBAClC;aACF,CAAC;SACH;QACD,MAAM,SAAS,GAAqB,EAAE,CAAC;QACvC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAS,EAAE,EAAE;YAChC,SAAS,CAAC,IAAI,CAAC;gBACb,IAAI,EAAE,CAAC;gBACP,SAAS,EAAE,CAAC;gBACZ,QAAQ,EAAE,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC;gBAC3B,IAAI,EAAE,iBAAiB,CAAC,SAAS;aAClC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QACH,OAAO,SAAS,CAAC;IACnB,CAAC;IAED,YAAY,IAAO,EAAE,OAAyB;;QAC5C,KAAK,CAAC,IAAW,EAAE,OAAO,CAAC,CAAC;QAxC9B,SAAI,GAAG,iBAAiB,CAAC,SAAS,CAAC;QACnC,SAAI,GAAW,iBAAiB,CAAC,SAAS,CAAC;QAG3C,YAAO,GAAG,WAAW,CAAC;QAEtB,iBAAY,GAAW,YAAY,CAAC,QAAQ,CAAC;QAC7C,gBAAW,GAAW,WAAW,CAAC,QAAQ,CAAC;QAC3C,eAAU,GAAgB,iBAAiB,CAAC;QAiC1C,IAAI,CAAC,WAAW,GAAG,MAAA,IAAI,CAAC,UAAU,yCAAoB,CAAC;IACzD,CAAC;IAED,eAAe;QACb,KAAK,CAAC,eAAe,EAAE,CAAC;QAExB,IAAI,SAAS,CAAE,IAAI,CAAC,KAAa,CAAC,IAAI,CAAC,EAAE;YACvC,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,KAAK,CAAC;YAC9B,IAAI,CAAC,SAAS,CAAC,MAAM,GAAI,IAAI,CAAC,KAAa,CAAC,IAAI,CAAC;YACjD,IAAI,CAAC,WAAW,CAAC,MAAM,GAAI,IAAI,CAAC,KAAa,CAAC,IAAI,CAAC;SACpD;QACD,IAAI,IAAI,CAAC,SAAS,CAAC,MAAM,IAAI,IAAI,CAAC,SAAS,CAAC,MAAM,IAAI,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE;YAC5E,IAA6B,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;SAC5E;IACH,CAAC;IAGD,WAAW,CAAC,GAAQ;;QAClB,IAAI,CAAC,iBAAiB,EAAE,CAAC;QACzB,MAAA,MAAA,IAAI,CAAC,MAAM,EAAC,YAAY,kDAAI,CAAC;QAC7B,KAAK,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;IACzB,CAAC;IAES,iBAAiB;QACzB,IAAI,IAAI,CAAC,UAAU,EAAE;YACnB,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC;gBAC5B,CAAC,EAAE,IAAI,CAAC,mBAAmB,EAAE,CAAC,CAAC;gBAC/B,CAAC,EAAE,IAAI,CAAC,mBAAmB,EAAE,CAAC,CAAC;gBAC/B,KAAK,EAAE,IAAI,CAAC,aAAa,EAAE,CAAC,KAAK;gBACjC,MAAM,EAAE,IAAI,CAAC,aAAa,EAAE,CAAC,MAAM;aACpC,CAAC,CAAC;SACJ;IACH,CAAC;IAES,aAAa;QACrB,IAAI,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE;YAC9B,OAAO,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC;SACzB;QAED,IAAI,IAAI,CAAC,aAAa,EAAE;YACtB,OAAO,IAAI,CAAC,aAAa,EAAE,CAAC,KAAK,CAAC;SACnC;QAED,OAAO,uBAAuB,CAAC;IACjC,CAAC;IAES,cAAc;QACtB,IAAI,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE;YAC/B,OAAO,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC;SAC1B;QAGD,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE;YACvB,OAAO,IAAI,CAAC,aAAa,EAAE,CAAC,MAAM,CAAC;SACpC;QAED,OAAO,uBAAuB,CAAC;IACjC,CAAC;IAEO,SAAS;;QACf,OAAO,gBACL,MAAM,EAAE,IAAI,CAAC,YAAY,EACzB,CAAC,EAAE,IAAI,CAAC,mBAAmB,EAAE,CAAC,CAAC,EAC/B,CAAC,EAAE,IAAI,CAAC,mBAAmB,EAAE,CAAC,CAAC,EAC/B,KAAK,EAAE,IAAI,CAAC,aAAa,EAAE,CAAC,KAAK,EACjC,MAAM,EAAE,IAAI,CAAC,aAAa,EAAE,CAAC,MAAM,EACnC,KAAK,EAAE,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,EAC/B,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,UAAU,EACzD,SAAS,EAAE,MAAA,IAAI,CAAC,KAAK,0CAAE,SAAS,EAChC,SAAS,EAAE,OAAO,CAAC,MAAA,IAAI,CAAC,KAAK,0CAAE,SAAS,CAAC,CAAC,CAAC,CAAC,MAAA,MAAA,IAAI,CAAC,KAAK,0CAAE,SAAS,mCAAI,EAAE,CAAC,CAAC,CAAC,CAAC,EAC3E,QAAQ,EAAE,MAAA,MAAA,IAAI,CAAC,KAAK,0CAAE,QAAQ,mCAAI,IAAI,IACnC,IAAI,CAAC,kBAAkB,EAAE,CACN,CAAC;IAC3B,CAAC;IAES,wBAAwB;QAChC,MAAM,KAAK,GAAG,IAAI,CAAC,SAAS,EAAE,CAAC;QAC/B,IAAI,IAAI,CAAC,UAAU,EAAE;YACnB,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;SACtC;aAAM;YACL,MAAM,SAAS,GAAG,IAAI,CAAC,YAAY,EAAE,CAAC;YACtC,IAAI,CAAC,UAAU,GAAG,IAAI,kBAAkB,CAAC,KAAK,CAAC,CAAC;YAEhD,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,QAAQ,EAAE,CAAC,CAAM,EAAE,EAAE;gBACpD,MAAM,KAAK,GAAG,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC;gBAC7B,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;YACzC,CAAC,CAAC,CAAC;YACH,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,UAA8B,CAAC,CAAC;SACpD;IACH,CAAC;IAES,aAAa,CAAC,KAAa,EAAE,GAAW,EAAE,eAAyB;QAC3E,KAAK,CAAC,aAAa,CAAC,KAAK,EAAE,GAAG,EAAE,eAAe,CAAC,CAAC;QACjD,IAAI,eAAe,IAAI,IAAI,CAAC,UAAU,EAAE;YACtC,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,OAAO,EAAE,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,CAAC;SACrD;QAED,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC;QAChB,MAAM,SAAS,GAAG,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,EAAE,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC,CAAC;QACtG,IAAI,SAAS,EAAE;YACb,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,eAAe,EAAE;gBAC1C,KAAK,EAAE,IAAI;gBACX,KAAK,EAAE;oBACL,UAAU,EAAE,IAAI,CAAC,WAAW,WAAqB;oBACjD,KAAK,EAAE,IAAI,CAAC,MAAM;oBAClB,GAAG,EAAE,IAAI,CAAC,IAAI;oBACd,UAAU,EAAE,IAAI,CAAC,WAAW;oBAC5B,QAAQ,EAAE,IAAI,CAAC,SAAS;oBACxB,SAAS,EAAE,IAAI,CAAC,UAAU;iBAC3B;aACF,CAAC,CAAC;SACJ;IACH,CAAC;IAES,2BAA2B;IAErC,CAAC;IAES,gBAAgB;QACxB,KAAK,CAAC,gBAAgB,EAAE,CAAC;QACzB,IAAI,IAAI,CAAC,UAAU,EAAE;YACnB,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,QAAQ,EAAE,CAAC,CAAM,EAAE,EAAE;gBACtC,MAAM,KAAK,GAAG,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC;gBAC7B,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;YACzC,CAAC,CAAC,CAAC;SACJ;IACH,CAAC;IAES,kBAAkB;QAC1B,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC;QAClD,MAAM,KAAK,GAAiC,EAAE,CAAC;QAE/C,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,EAAE;YACxB,KAAK,CAAC,OAAO,GAAG,YAAY,CAAC;SAC9B;QAED,IAAI,CAAC,OAAO,CAAC,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,KAAK,CAAC,EAAE;YACzB,KAAK,CAAC,SAAS,GAAG,kBAAkB,CAAC,IAAI,CAAC,KAAK,CAAqC,CAAC;SACtF;QACD,IAAI,CAAC,OAAO,CAAC,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,KAAK,CAAC,EAAE;YAC3B,KAAK,CAAC,WAAW,GAAG,kBAAkB,CAAC,MAAM,CAAC,KAAK,CAAqC,CAAC;SAC1F;QACD,KAAK,CAAC,mBAAmB,GAAG,IAAI,CAAC,OAAO,CAAC,mBAAmB,CAAC;QAC7D,OAAO,KAAK,CAAC;IACf,CAAC;IAES,8BAA8B;QACtC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAwB,CAAC;IAClD,CAAC;;AA/LM,cAAI,GAAG,iBAAiB,CAAC,SAAS,CAAC;AAInC,iBAAO,GAAG,WAAW,CAAC;AA8L/B,MAAM,CAAC,MAAM,iBAAiB,GAAG,GAAG,EAAE;IACpC,OAAO,CAAC,iBAAiB,CAAC,SAAS,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;AACvD,CAAC,CAAC","file":"scroll-bar.js","sourcesContent":["import type { Maybe } from '@visactor/vutils';\nimport { isArray, isBoolean, isEmpty, isNil, isNumber, isValid } from '@visactor/vutils';\nimport type { IComponentOption } from '../../interface';\n// eslint-disable-next-line no-duplicate-imports\nimport { ComponentTypeEnum } from '../../interface/type';\nimport { DataFilterBaseComponent } from '../data-filter-base-component';\nimport type { ScrollBarAttributes } from '@visactor/vrender-components';\n// eslint-disable-next-line no-duplicate-imports\nimport { ScrollBar as ScrollBarComponent } from '@visactor/vrender-components';\nimport { transformToGraphic } from '../../../util/style';\nimport type { IRectGraphicAttribute, INode, IGroup, IGraphic } from '@visactor/vrender-core';\nimport { ChartEvent, LayoutLevel, LayoutZIndex } from '../../../constant';\nimport { SCROLL_BAR_DEFAULT_SIZE } from '../../../constant/scroll-bar';\nimport type { IScrollBarSpec } from './interface';\nimport { IFilterMode } from '../constant';\nimport { Factory } from '../../../core/factory';\nimport type { IZoomable } from '../../../interaction/zoom';\nimport type { ILayoutType } from '../../../typings/layout';\nimport type { IModelSpecInfo } from '../../../model/interface';\n\nexport class ScrollBar<T extends IScrollBarSpec = IScrollBarSpec> extends DataFilterBaseComponent<T> {\n  static type = ComponentTypeEnum.scrollBar;\n  type = ComponentTypeEnum.scrollBar;\n  name: string = ComponentTypeEnum.scrollBar;\n\n  static specKey = 'scrollBar';\n  specKey = 'scrollBar';\n\n  layoutZIndex: number = LayoutZIndex.DataZoom;\n  layoutLevel: number = LayoutLevel.DataZoom;\n  layoutType: ILayoutType = 'region-relative';\n\n  // datazoom组件\n  protected _component!: ScrollBarComponent;\n\n  static getSpecInfo(chartSpec: any): Maybe<IModelSpecInfo[]> {\n    const compSpec = chartSpec[this.specKey];\n    if (isNil(compSpec)) {\n      return undefined;\n    }\n    if (!isArray(compSpec)) {\n      return [\n        {\n          spec: compSpec,\n          specPath: [this.specKey],\n          type: ComponentTypeEnum.scrollBar\n        }\n      ];\n    }\n    const specInfos: IModelSpecInfo[] = [];\n    compSpec.forEach((s, i: number) => {\n      specInfos.push({\n        spec: s,\n        specIndex: i,\n        specPath: [this.specKey, i],\n        type: ComponentTypeEnum.scrollBar\n      });\n    });\n    return specInfos;\n  }\n\n  constructor(spec: T, options: IComponentOption) {\n    super(spec as any, options);\n    this._filterMode = spec.filterMode ?? IFilterMode.axis;\n  }\n\n  setAttrFromSpec() {\n    super.setAttrFromSpec();\n    // roam兼容逻辑\n    if (isBoolean((this._spec as any).roam)) {\n      this._zoomAttr.enable = false; // 对于之前的逻辑而言，只要配置了roam，zoom始终不打开\n      this._dragAttr.enable = (this._spec as any).roam;\n      this._scrollAttr.enable = (this._spec as any).roam;\n    }\n    if (this._zoomAttr.enable || this._dragAttr.enable || this._scrollAttr.enable) {\n      (this as unknown as IZoomable).initZoomable(this.event, this._option.mode);\n    }\n  }\n\n  /** LifeCycle API**/\n  onLayoutEnd(ctx: any): void {\n    this._updateScaleRange();\n    this.effect.onZoomChange?.();\n    super.onLayoutEnd(ctx);\n  }\n\n  protected _updateScaleRange() {\n    if (this._component) {\n      this._component.setAttributes({\n        x: this.getLayoutStartPoint().x,\n        y: this.getLayoutStartPoint().y,\n        width: this.getLayoutRect().width,\n        height: this.getLayoutRect().height\n      });\n    }\n  }\n\n  protected _computeWidth(): number {\n    if (isNumber(this._spec.width)) {\n      return this._spec.width;\n    }\n\n    if (this._isHorizontal) {\n      return this.getLayoutRect().width;\n    }\n    // default value\n    return SCROLL_BAR_DEFAULT_SIZE;\n  }\n\n  protected _computeHeight(): number {\n    if (isNumber(this._spec.height)) {\n      return this._spec.height;\n    }\n\n    // default value\n    if (!this._isHorizontal) {\n      return this.getLayoutRect().height;\n    }\n\n    return SCROLL_BAR_DEFAULT_SIZE;\n  }\n\n  private _getAttrs() {\n    return {\n      zIndex: this.layoutZIndex,\n      x: this.getLayoutStartPoint().x,\n      y: this.getLayoutStartPoint().y,\n      width: this.getLayoutRect().width,\n      height: this.getLayoutRect().height,\n      range: [this._start, this._end],\n      direction: this._isHorizontal ? 'horizontal' : 'vertical',\n      delayType: this._spec?.delayType,\n      delayTime: isValid(this._spec?.delayType) ? this._spec?.delayTime ?? 30 : 0,\n      realTime: this._spec?.realTime ?? true,\n      ...this._getComponentAttrs()\n    } as ScrollBarAttributes;\n  }\n\n  protected _createOrUpdateComponent() {\n    const attrs = this._getAttrs();\n    if (this._component) {\n      this._component.setAttributes(attrs);\n    } else {\n      const container = this.getContainer();\n      this._component = new ScrollBarComponent(attrs);\n      // 绑定事件，防抖，防止频繁触发\n      this._component.addEventListener('scroll', (e: any) => {\n        const value = e.detail.value;\n        this._handleChange(value[0], value[1]);\n      });\n      container.add(this._component as unknown as INode);\n    }\n  }\n\n  protected _handleChange(start: number, end: number, updateComponent?: boolean) {\n    super._handleChange(start, end, updateComponent);\n    if (updateComponent && this._component) {\n      this._component.setAttribute('range', [start, end]);\n    }\n\n    this._start = start;\n    this._end = end;\n    const hasChange = this._handleStateChange(this._statePointToData(start), this._statePointToData(end));\n    if (hasChange) {\n      this.event.emit(ChartEvent.scrollBarChange, {\n        model: this,\n        value: {\n          filterData: this._filterMode !== IFilterMode.axis,\n          start: this._start,\n          end: this._end,\n          startValue: this._startValue,\n          endValue: this._endValue,\n          newDomain: this._newDomain\n        }\n      });\n    }\n  }\n\n  protected _handleDataCollectionChange() {\n    // do nothing\n  }\n\n  protected _initCommonEvent() {\n    super._initCommonEvent();\n    if (this._component) {\n      this._component.on('scroll', (e: any) => {\n        const value = e.detail.value;\n        this._handleChange(value[0], value[1]);\n      });\n    }\n  }\n\n  protected _getComponentAttrs() {\n    const { rail, slider, innerPadding } = this._spec;\n    const attrs: Partial<ScrollBarAttributes> = {};\n\n    if (!isNil(innerPadding)) {\n      attrs.padding = innerPadding;\n    }\n\n    if (!isEmpty(rail?.style)) {\n      attrs.railStyle = transformToGraphic(rail.style) as unknown as IRectGraphicAttribute;\n    }\n    if (!isEmpty(slider?.style)) {\n      attrs.sliderStyle = transformToGraphic(slider.style) as unknown as IRectGraphicAttribute;\n    }\n    attrs.disableTriggerEvent = this._option.disableTriggerEvent;\n    return attrs;\n  }\n\n  protected _getNeedClearVRenderComponents(): IGraphic[] {\n    return [this._component] as unknown as IGroup[];\n  }\n}\n\nexport const registerScrollBar = () => {\n  Factory.registerComponent(ScrollBar.type, ScrollBar);\n};\n"]}