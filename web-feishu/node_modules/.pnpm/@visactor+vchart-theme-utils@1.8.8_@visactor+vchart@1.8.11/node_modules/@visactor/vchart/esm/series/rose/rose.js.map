{"version":3,"sources":["../src/series/rose/rose.ts"],"names":[],"mappings":"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","file":"rose.js","sourcesContent":["/* eslint-disable no-duplicate-imports */\nimport type { IArcMark } from '../../mark/arc';\nimport type { Maybe, Datum } from '../../typings';\nimport { valueInScaleRange } from '../../util/scale';\nimport { animationConfig, shouldMarkDoMorph, userAnimationConfig } from '../../animation/utils';\nimport type { SeriesMarkMap } from '../interface';\nimport { SeriesMarkNameEnum, SeriesTypeEnum } from '../interface/type';\nimport { registerRoseAnimation, type IRoseAnimationParams, type RoseAppearPreset } from './animation';\nimport type { IRoseSeriesSpec, IRoseSeriesTheme } from './interface';\nimport { RoseLikeSeries } from '../polar/rose-like';\nimport type { IStateAnimateSpec } from '../../animation/spec';\nimport type { ITextMark } from '../../mark/text';\nimport { ArcMark, registerArcMark } from '../../mark/arc';\nimport { roseSeriesMark } from './constant';\nimport { Factory } from '../../core/factory';\nimport type { IMark } from '../../mark/interface';\nimport type { ILabelMark } from '../../mark/label';\nimport { RoseSeriesSpecTransformer } from './rose-transformer';\n\nexport const DefaultBandWidth = 0.5;\n\nexport class RoseSeries<T extends IRoseSeriesSpec = IRoseSeriesSpec> extends RoseLikeSeries<T> {\n  static readonly type: string = SeriesTypeEnum.rose;\n  type = SeriesTypeEnum.rose;\n\n  static readonly mark: SeriesMarkMap = roseSeriesMark;\n  static readonly transformerConstructor = RoseSeriesSpecTransformer as any;\n  readonly transformerConstructor = RoseSeriesSpecTransformer;\n\n  protected _supportStack: boolean = true;\n\n  private _roseMark: IArcMark | null = null;\n  protected _labelMark: ITextMark | null = null;\n\n  initMark(): void {\n    this.initRoseMark();\n  }\n\n  initMarkStyle(): void {\n    this.initRoseMarkStyle();\n  }\n\n  protected _buildMarkAttributeContext() {\n    super._buildMarkAttributeContext();\n    // center\n    this._markAttributeContext.getCenter = () => {\n      return {\n        x: () => this.angleAxisHelper.center().x,\n        y: () => this.angleAxisHelper.center().y\n      };\n    };\n    // angle scale\n    this._markAttributeContext.startAngleScale = (datum: Datum) => this.startAngleScale(datum);\n    this._markAttributeContext.endAngleScale = (datum: Datum) => this.endAngleScale(datum);\n  }\n\n  private initRoseMark() {\n    this._roseMark = this._createMark(RoseSeries.mark.rose, {\n      morph: shouldMarkDoMorph(this._spec, RoseSeries.mark.rose.name),\n      defaultMorphElementKey: this.getDimensionField()[0],\n      groupKey: this._seriesField,\n      isSeriesMark: true,\n      customShape: this._spec.rose?.customShape\n    }) as IArcMark;\n  }\n\n  private getRoseAngle() {\n    const angleBandWidth =\n      this.angleAxisHelper.getBandwidth?.(this._groups ? this._groups.fields.length - 1 : 0) ?? DefaultBandWidth;\n    return angleBandWidth;\n  }\n\n  private startAngleScale(datum: Datum) {\n    return (\n      this.angleAxisHelper.dataToPosition(this.getDatumPositionValues(datum, this.getGroupFields())) -\n      this.angleAxisHelper.getBandwidth(this.getGroupFields().length - 1) * 0.5\n    );\n  }\n\n  private endAngleScale(datum: Datum) {\n    return (\n      this.angleAxisHelper.dataToPosition(this.getDatumPositionValues(datum, this.getGroupFields())) +\n      this.getRoseAngle() -\n      this.angleAxisHelper.getBandwidth(this.getGroupFields().length - 1) * 0.5\n    );\n  }\n\n  private initRoseMarkStyle() {\n    const roseMark = this._roseMark;\n    if (roseMark) {\n      this.setMarkStyle(roseMark, {\n        x: () => this.angleAxisHelper.center().x,\n        y: () => this.angleAxisHelper.center().y,\n        startAngle: (datum: Datum) => this.startAngleScale(datum),\n        endAngle: (datum: Datum) => this.endAngleScale(datum),\n        fill: this.getColorAttribute(),\n        outerRadius: (datum: Datum) =>\n          valueInScaleRange(\n            this.radiusAxisHelper.dataToPosition([datum[this._radiusField[0]]]),\n            this.radiusAxisHelper.getScale(0)\n          ),\n        innerRadius: (datum: Datum) => {\n          if (!this._stack) {\n            return 0;\n          }\n          const stackStart = valueInScaleRange(\n            this.radiusAxisHelper.dataToPosition([datum[this._innerRadiusField[0]]]),\n            this.radiusAxisHelper.getScale(0)\n          );\n          return stackStart <= Number.MIN_VALUE\n            ? this._computeLayoutRadius() * (this._spec.innerRadius ?? 0)\n            : stackStart;\n        }\n      });\n      this._trigger.registerMark(roseMark);\n    }\n  }\n\n  protected initTooltip() {\n    super.initTooltip();\n\n    this._roseMark && this._tooltipHelper.activeTriggerSet.mark.add(this._roseMark);\n  }\n\n  initLabelMarkStyle(textMark: ILabelMark) {\n    if (!textMark) {\n      return;\n    }\n    this.setMarkStyle(textMark, {\n      visible: this._spec?.label?.visible,\n      text: (datum: Datum) => {\n        return datum[this.getDimensionField()[0]];\n      },\n      fill: this._spec.label?.style?.fill || this.getColorAttribute(),\n      angle: this._spec.label?.style?.angle,\n      limit: this._spec.label?.style?.limit,\n      z: 0\n    });\n  }\n\n  initAnimation() {\n    const appearPreset = (this._spec?.animationAppear as IStateAnimateSpec<RoseAppearPreset>)?.preset;\n\n    if (this._roseMark) {\n      const animationParams: IRoseAnimationParams = {\n        innerRadius: () => this._computeLayoutRadius() * (this._spec.innerRadius ?? 0)\n      };\n      this._roseMark.setAnimationConfig(\n        animationConfig(\n          Factory.getAnimationInKey('rose')?.(animationParams, appearPreset),\n          userAnimationConfig(SeriesMarkNameEnum.rose, this._spec, this._markAttributeContext)\n        )\n      );\n    }\n  }\n\n  getDefaultShapeType() {\n    return 'circle';\n  }\n\n  getActiveMarks(): IMark[] {\n    return [this._roseMark];\n  }\n}\n\nexport const registerRoseSeries = () => {\n  Factory.registerSeries(RoseSeries.type, RoseSeries);\n  registerArcMark();\n  registerRoseAnimation();\n};\n"]}