{"version":3,"sources":["../src/component/tooltip/processor/mark-tooltip.ts"],"names":[],"mappings":";;;AAIA,iCAA8C;AAC9C,6CAAyC;AAGzC,MAAa,oBAAqB,SAAQ,2BAAoB;IAA9D;;QACE,eAAU,GAAsB,MAAM,CAAC;IAwDzC,CAAC;IArDC,WAAW,CAAC,IAAqB,EAAE,MAAuB,EAAE,kBAA2B;QACrF,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,aAAa,EAAE,GAAG,IAAI,CAAC;QAC9C,MAAM,WAAW,GAAG,CAAC,EAAE,KAAK,EAAE,CAAC,KAAK,CAAC,EAAE,MAAM,EAAE,CAAC,CAAC;QACjD,MAAM,SAAS,mCACV,MAAM,KACT,aAAa,EAAE,IAAI,CAAC,wBAAwB,CAAC,aAAa,CAAC,EAC3D,kBAAkB,GACnB,CAAC;QACF,OAAO,IAAI,CAAC,qBAAqB,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;IAC5D,CAAC;IAGD,mBAAmB,CAAC,MAAuB,EAAE,cAAuC;;QAClF,MAAM,EAAE,WAAW,EAAE,IAAI,EAAE,GAAG,cAAc,CAAC;QAC7C,IAAI,IAAA,cAAK,EAAC,IAAI,CAAC,EAAE;YACf,OAAO,KAAK,CAAC;SACd;QAED,MAAM,MAAM,GAAG,MAAC,MAAM,CAAC,KAAiB,0CAAE,aAAa,CAAC;QACxD,IAAI,CAAC,CAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,UAAU,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAA,EAAE;YACxC,OAAO,KAAK,CAAC;SACd;QACD,OAAO,IAAI,CAAC;IACd,CAAC;IAGD,iBAAiB,CAAC,MAAuB;;QACvC,IAAI,IAAiC,CAAC;QACtC,IAAI,MAA2B,CAAC;QAGhC,IAAI,CAAA,MAAA,MAAM,CAAC,KAAK,0CAAE,SAAS,MAAK,QAAQ,EAAE;YACxC,MAAM,MAAM,GAAG,MAAM,CAAC,KAAgB,CAAC;YACvC,MAAM,MAAM,GAAG,MAAM,CAAC,aAAa,CAAC;YACpC,MAAM,cAAc,GAAG,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,gBAAgB,CAAC,IAAI,CAAC;YACrD,MAAM,cAAc,GAAG,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,gBAAgB,CAAC,IAAI,CAAC;YACrD,IAAI,CAAA,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,MAAI,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA,EAAE;gBACzE,IAAI,GAAG;oBACL,IAAI,EAAE,MAAM,CAAC,IAAI;oBACjB,KAAK,EAAE,MAAM,CAAC,KAAK;oBACnB,MAAM;oBACN,aAAa,EAAE,IAAI,CAAC,iBAAiB,CAAC,MAAM,CAAC;iBAC9C,CAAC;aACH;iBAAM,IAAI,CAAA,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,MAAI,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA,EAAE;gBAChF,MAAM,GAAG,IAAI,CAAC;aACf;SACF;QAED,OAAO;YACL,WAAW,EAAE,IAAI;YACjB,MAAM;SACP,CAAC;IACJ,CAAC;CACF;AAzDD,oDAyDC","file":"mark-tooltip.js","sourcesContent":["import type { BaseEventParams } from '../../../event/interface';\nimport type { TooltipActiveType } from '../../../typings';\nimport type { TooltipHandlerParams } from '../interface';\nimport type { MarkTooltipInfo, MouseEventData } from './interface';\nimport { BaseTooltipProcessor } from './base';\nimport { isNil } from '@visactor/vutils';\nimport type { ISeries } from '../../../series/interface';\n\nexport class MarkTooltipProcessor extends BaseTooltipProcessor {\n  activeType: TooltipActiveType = 'mark';\n\n  /** 触发对应类型的 tooltip */\n  showTooltip(info: MarkTooltipInfo, params: BaseEventParams, changePositionOnly: boolean) {\n    const { datum, series, dimensionInfo } = info;\n    const tooltipData = [{ datum: [datum], series }];\n    const newParams: TooltipHandlerParams = {\n      ...params,\n      dimensionInfo: this._preprocessDimensionInfo(dimensionInfo),\n      changePositionOnly\n    };\n    return this._showTooltipByHandler(tooltipData, newParams);\n  }\n\n  /** 判断是否应该触发 tooltip */\n  shouldHandleTooltip(params: BaseEventParams, mouseEventData: Partial<MouseEventData>): boolean {\n    const { tooltipInfo: info } = mouseEventData;\n    if (isNil(info)) {\n      return false;\n    }\n\n    const helper = (params.model as ISeries)?.tooltipHelper;\n    if (!helper?.activeType.includes('mark')) {\n      return false;\n    }\n    return true;\n  }\n\n  /** 获取触发 tooltip 需要的信息 */\n  getMouseEventData(params: BaseEventParams): MouseEventData {\n    let info: MarkTooltipInfo | undefined;\n    let ignore: boolean | undefined;\n\n    // 处理mark info\n    if (params.model?.modelType === 'series') {\n      const series = params.model as ISeries;\n      const helper = series.tooltipHelper;\n      const activeTriggers = helper?.activeTriggerSet.mark;\n      const ignoreTriggers = helper?.ignoreTriggerSet.mark;\n      if (activeTriggers?.has(params.model) || activeTriggers?.has(params.mark)) {\n        info = {\n          mark: params.mark,\n          datum: params.datum,\n          series,\n          dimensionInfo: this._getDimensionInfo(params)\n        };\n      } else if (ignoreTriggers?.has(params.model) || ignoreTriggers?.has(params.mark)) {\n        ignore = true;\n      }\n    }\n\n    return {\n      tooltipInfo: info,\n      ignore\n    };\n  }\n}\n"]}