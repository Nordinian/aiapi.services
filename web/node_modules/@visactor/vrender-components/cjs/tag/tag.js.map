{"version":3,"sources":["../src/tag/tag.ts"],"names":[],"mappings":"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","file":"tag.js","sourcesContent":["/**\n * @description 标签组件\n */\nimport type {\n  IGroup,\n  IRect,\n  ISymbol,\n  IText,\n  ITextAttribute,\n  ITextGraphicAttribute,\n  IRichTextGraphicAttribute,\n  IRichText,\n  IRichTextCharacter\n} from '@visactor/vrender-core';\nimport { isBoolean, isEmpty, isNil, isNumber, isValid, merge, normalizePadding } from '@visactor/vutils';\nimport { AbstractComponent } from '../core/base';\nimport { measureTextSize } from '../util';\nimport type { BackgroundAttributes, ComponentOptions } from '../interface';\nimport type { TagAttributes, TagShapeAttributes } from './type';\nimport { DEFAULT_HTML_TEXT_SPEC } from '../constant';\nimport { loadTagComponent } from './register';\n\nloadTagComponent();\nexport class Tag extends AbstractComponent<Required<TagAttributes>> {\n  name = 'tag';\n\n  static defaultAttributes: Partial<TagAttributes> = {\n    visible: true,\n    textStyle: {\n      fontSize: 12,\n      fill: '#000',\n      textAlign: 'left',\n      textBaseline: 'top'\n    },\n    space: 4,\n    padding: 4,\n    // @ts-ignore\n    shape: {\n      fill: '#000'\n    }\n  };\n\n  constructor(attributes: TagAttributes, options?: ComponentOptions) {\n    super(options?.skipDefault ? attributes : merge({}, Tag.defaultAttributes, attributes));\n  }\n\n  protected render() {\n    const {\n      text = '',\n      textStyle = {} as ITextGraphicAttribute | IRichTextGraphicAttribute,\n      shape = {} as TagShapeAttributes,\n      panel = {} as BackgroundAttributes,\n      space = 4,\n      minWidth,\n      maxWidth,\n      padding = 4,\n      visible,\n      state,\n      type,\n      textAlwaysCenter\n    } = this.attribute as TagAttributes;\n    const parsedPadding = normalizePadding(padding);\n\n    const group = this.createOrUpdateChild('tag-content', { x: 0, y: 0, zIndex: 1 }, 'group') as IGroup;\n\n    let symbol;\n    let tagWidth = parsedPadding[1] + parsedPadding[3];\n    let tagHeight = parsedPadding[0] + parsedPadding[2];\n    let textX = 0;\n    let symbolPlaceWidth = 0;\n    const { visible: shapeVisible, ...shapeStyle } = shape;\n    if (isBoolean(shapeVisible)) {\n      const size = shapeStyle?.size || 10;\n      const maxSize = isNumber(size) ? size : Math.max(size[0], size[1]);\n\n      symbol = group.createOrUpdateChild(\n        'tag-shape',\n        {\n          symbolType: 'circle',\n          size,\n          strokeBoundsBuffer: 0,\n          ...shapeStyle,\n          visible: shapeVisible,\n          x: maxSize / 2,\n          y: maxSize / 2\n        },\n        'symbol'\n      ) as ISymbol;\n      if (!isEmpty(state?.shape)) {\n        symbol.states = state.shape;\n      }\n\n      if (shapeVisible) {\n        symbolPlaceWidth = maxSize + space;\n      }\n    }\n\n    tagWidth += symbolPlaceWidth;\n    textX += symbolPlaceWidth;\n\n    let textShape;\n    if (type === 'rich') {\n      const richTextAttrs = {\n        textConfig: text as IRichTextCharacter[],\n        visible: isValid(text) && visible !== false,\n        ...(textStyle as IRichTextGraphicAttribute),\n        x: textX,\n        y: 0,\n        width: (textStyle as IRichTextGraphicAttribute).width ?? 0,\n        height: (textStyle as IRichTextGraphicAttribute).height ?? 0\n      };\n      textShape = group.createOrUpdateChild('tag-text', richTextAttrs, 'richtext') as IRichText;\n\n      // 绘制背景层\n      const { visible: bgVisible, ...backgroundStyle } = panel;\n      if (visible && isBoolean(bgVisible)) {\n        const bgRect = this.createOrUpdateChild(\n          'tag-panel',\n          {\n            ...backgroundStyle,\n            visible: bgVisible && !!text,\n            x: textShape.AABBBounds.x1,\n            y: textShape.AABBBounds.y1,\n            width: textShape.AABBBounds.width(),\n            height: textShape.AABBBounds.height()\n          },\n          'rect'\n        ) as IRect;\n        if (!isEmpty(state?.panel)) {\n          bgRect.states = state.panel;\n        }\n      }\n    } else if (type === 'html') {\n      const richTextAttrs = {\n        textConfig: [] as IRichTextCharacter[],\n        visible: isValid(text) && visible !== false,\n        html: {\n          dom: text as string,\n          ...DEFAULT_HTML_TEXT_SPEC,\n          ...textStyle\n        },\n        ...(textStyle as IRichTextGraphicAttribute),\n        x: textX,\n        y: 0\n      };\n      textShape = group.createOrUpdateChild('tag-text', richTextAttrs, 'richtext') as IRichText;\n\n      // 绘制背景层\n      const { visible: bgVisible, ...backgroundStyle } = panel;\n      if (visible && isBoolean(bgVisible)) {\n        const bgRect = this.createOrUpdateChild(\n          'tag-panel',\n          {\n            ...backgroundStyle,\n            visible: bgVisible && !!text,\n            x: textShape.AABBBounds.x1,\n            y: textShape.AABBBounds.y1,\n            width: textShape.AABBBounds.width(),\n            height: textShape.AABBBounds.height()\n          },\n          'rect'\n        ) as IRect;\n        if (!isEmpty(state?.panel)) {\n          bgRect.states = state.panel;\n        }\n      }\n    } else {\n      const textAttrs = {\n        text: text as string | number | string[] | number[],\n        visible: isValid(text) && visible !== false,\n        lineHeight: (textStyle as ITextGraphicAttribute)?.fontSize,\n        ...(textStyle as ITextGraphicAttribute),\n        x: textX,\n        y: 0\n      };\n      if (isNil(textAttrs.lineHeight)) {\n        textAttrs.lineHeight = (textStyle as ITextGraphicAttribute).fontSize;\n      }\n      textShape = group.createOrUpdateChild('tag-text', textAttrs, 'text') as IText;\n      if (!isEmpty(state?.text)) {\n        textShape.states = state.text;\n      }\n\n      // 因为文本可能发生旋转，所以需要使用 measureTextSize 方法\n      const textBounds = measureTextSize(textAttrs.text as string, textStyle, this.stage?.getTheme().text.fontFamily);\n      const textWidth = textBounds.width;\n      const textHeight = textBounds.height;\n      tagWidth += textWidth;\n      const size = shape.size ?? 10;\n      const maxSize = isNumber(size) ? size : Math.max(size[0], size[1]);\n      tagHeight += Math.max(textHeight, shape.visible ? maxSize : 0);\n\n      const { textAlign, textBaseline } = textStyle as ITextAttribute;\n\n      if (isValid(minWidth) || isValid(maxWidth)) {\n        if (isValid(minWidth) && tagWidth < minWidth) {\n          tagWidth = minWidth;\n        }\n        if (isValid(maxWidth) && tagWidth > maxWidth) {\n          tagWidth = maxWidth;\n          textShape.setAttribute('maxLineWidth', maxWidth - parsedPadding[1] - parsedPadding[2]);\n        }\n      }\n\n      let x = 0;\n      let y = 0;\n      if (textAlign === 'center') {\n        x -= tagWidth / 2;\n        if (symbol) {\n          symbol.setAttribute('x', (symbol.attribute.x || 0) - textWidth / 2);\n        }\n\n        group.setAttribute('x', -symbolPlaceWidth / 2);\n      } else if (textAlign === 'right' || textAlign === 'end') {\n        x -= tagWidth;\n        if (symbol) {\n          symbol.setAttribute('x', (symbol.attribute.x || 0) - textWidth);\n        }\n\n        group.setAttribute('x', -parsedPadding[1] - symbolPlaceWidth);\n      } else if (textAlign === 'left' || textAlign === 'start') {\n        group.setAttribute('x', parsedPadding[3]);\n      }\n\n      if (textAlwaysCenter && (textAlign === 'left' || textAlign === 'start')) {\n        // for flex layout\n        textShape.setAttributes({\n          x: textX + tagWidth / 2,\n          textAlign: 'center'\n        });\n      }\n\n      if (textBaseline === 'middle') {\n        y -= tagHeight / 2;\n        if (symbol) {\n          symbol.setAttribute('y', 0);\n        }\n      } else if (textBaseline === 'bottom') {\n        y -= tagHeight;\n        if (symbol) {\n          symbol.setAttribute('y', -textHeight / 2);\n        }\n\n        group.setAttribute('y', -parsedPadding[2]);\n      } else if (textBaseline === 'top') {\n        group.setAttribute('y', parsedPadding[0]);\n        if (symbol) {\n          symbol.setAttribute('y', textHeight / 2);\n        }\n      }\n\n      // 绘制背景层\n      const { visible: bgVisible, ...backgroundStyle } = panel;\n      if (visible && isBoolean(bgVisible)) {\n        const bgRect = this.createOrUpdateChild(\n          'tag-panel',\n          {\n            ...backgroundStyle,\n            visible: bgVisible && !!text,\n            x,\n            y,\n            width: tagWidth,\n            height: tagHeight\n          },\n          'rect'\n        ) as IRect;\n        if (!isEmpty(state?.panel)) {\n          bgRect.states = state.panel;\n        }\n      }\n    }\n  }\n}\n"]}