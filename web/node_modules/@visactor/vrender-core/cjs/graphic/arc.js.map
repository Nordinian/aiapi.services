{"version":3,"sources":["../src/graphic/arc.ts"],"names":[],"mappings":"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","file":"arc.js","sourcesContent":["import type { AABBBounds, OBBBounds } from '@visactor/vutils';\nimport { pi2, sin, epsilon, abs, asin, clampAngleByRadian, isNumber, cos, sqrt } from '@visactor/vutils';\nimport type { IArc, IArcGraphicAttribute } from '../interface/graphic/arc';\nimport { Graphic, GRAPHIC_UPDATE_TAG_KEY, NOWORK_ANIMATE_ATTR } from './graphic';\nimport { CustomPath2D } from '../common/custom-path2d';\nimport { parsePadding } from '../common/utils';\nimport { getTheme } from './theme';\nimport { application } from '../application';\nimport type { GraphicType } from '../interface';\nimport { ARC_NUMBER_TYPE } from './constants';\n\n/**\n * 部分代码参考 https://github.com/d3/d3-shape/\n * Copyright 2010-2022 Mike Bostock\n\n  Permission to use, copy, modify, and/or distribute this software for any purpose\n  with or without fee is hereby granted, provided that the above copyright notice\n  and this permission notice appear in all copies.\n\n  THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\n  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND\n  FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\n  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\n  OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER\n  TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF\n  THIS SOFTWARE.\n */\n\nconst ARC_UPDATE_TAG_KEY = [\n  'innerRadius',\n  'outerRadius',\n  'startAngle',\n  'endAngle',\n  'cornerRadius',\n  'padAngle',\n  'padRadius',\n  'cap',\n  ...GRAPHIC_UPDATE_TAG_KEY\n];\n\n/**\n * 圆形图元\n * 默认顺时针绘制\n */\nexport class Arc extends Graphic<IArcGraphicAttribute> implements IArc {\n  type: GraphicType = 'arc';\n\n  static NOWORK_ANIMATE_ATTR = {\n    cap: 1,\n    ...NOWORK_ANIMATE_ATTR\n  };\n\n  // static parseCornerRadius(r: IArcGraphicAttribute['cornerRadius']) {\n  //   if (isArray(r)) {\n  //     if ((r as any[]).length === 1) {\n  //       const value = r[0];\n  //       return [value, value, value, value];\n  //     }\n\n  //     if ((r as any[]).length === 2) {\n  //       return [r[0], r[0], r[1], r[1]];\n  //     }\n\n  //     if ((r as any[]).length === 3) {\n  //       return [r[0], r[1], r[2], 0];\n  //     }\n\n  //     return (r as any[]).slice(0, 4);\n  //   }\n\n  //   return [r as string | number, r as string | number, r as string | number, r as string | number];\n  // }\n\n  // static isCornerRadiusEqual(oldR: IArcGraphicAttribute['cornerRadius'], newR: IArcGraphicAttribute['cornerRadius']) {\n  //   throw new Error('暂不支持');\n  //   if (oldR === newR) {\n  //     return true;\n  //   }\n\n  //   if (isArray(oldR) && !isArray(newR)) {\n  //     return (oldR as (string | number)[]).every(r => r === newR);\n  //   }\n\n  //   if (!isArray(oldR) && isArray(newR)) {\n  //     return (newR as (string | number)[]).every(r => r === oldR);\n  //   }\n\n  //   return arrayEqual(oldR as (string | number)[], newR as (string | number)[]);\n  // }\n\n  constructor(params: IArcGraphicAttribute) {\n    super(params);\n    this.numberType = ARC_NUMBER_TYPE;\n  }\n\n  isValid(): boolean {\n    return super.isValid() && this._isValid();\n  }\n  private _isValid(): boolean {\n    const { startAngle, endAngle, outerRadius, innerRadius } = this.attribute;\n    return (\n      this._validNumber(startAngle) &&\n      this._validNumber(endAngle) &&\n      this._validNumber(outerRadius) &&\n      this._validNumber(innerRadius)\n    );\n  }\n\n  getParsedCornerRadius() {\n    const arcTheme = getTheme(this).arc;\n    const {\n      cornerRadius = arcTheme.cornerRadius,\n      outerRadius = arcTheme.outerRadius,\n      innerRadius = arcTheme.innerRadius\n    } = this.attribute;\n    if (cornerRadius === 0 || cornerRadius === '0%') {\n      return 0;\n    }\n    const deltaRadius = Math.abs(outerRadius - innerRadius);\n    return Math.min(\n      isNumber(cornerRadius, true)\n        ? (cornerRadius as number)\n        : (deltaRadius * parseFloat(cornerRadius as string)) / 100,\n      deltaRadius / 2\n    );\n  }\n\n  getParsedAngle() {\n    const arcTheme = getTheme(this).arc;\n    let { startAngle = arcTheme.startAngle, endAngle = arcTheme.endAngle } = this.attribute;\n    const { cap = arcTheme.cap } = this.attribute;\n\n    const sign = endAngle - startAngle >= 0 ? 1 : -1;\n    const deltaAngle = endAngle - startAngle;\n\n    startAngle = clampAngleByRadian(startAngle);\n    endAngle = startAngle + deltaAngle;\n\n    if (cap && abs(deltaAngle) < pi2 - epsilon) {\n      let startCap = 1;\n      let endCap = 1;\n      if ((cap as boolean[]).length) {\n        startCap = Number(cap[0]);\n        endCap = Number(cap[1]);\n      }\n      const { outerRadius = arcTheme.outerRadius, innerRadius = arcTheme.innerRadius } = this.attribute;\n      const capWidth = Math.abs(outerRadius - innerRadius) / 2;\n      // 以外边界长度为准\n      const capAngle = capWidth / outerRadius;\n\n      if (capWidth > epsilon && outerRadius > epsilon) {\n        return {\n          startAngle: startAngle - sign * capAngle * startCap,\n          endAngle: endAngle + sign * capAngle * endCap,\n          sc: sign * capAngle * startCap,\n          ec: sign * capAngle * endCap\n        };\n      }\n    }\n\n    return {\n      startAngle: startAngle,\n      endAngle: endAngle\n    };\n  }\n\n  // 参考 https://github.com/d3/d3-shape/blob/main/src/arc.js\n  getParsePadAngle(startAngle: number, endAngle: number) {\n    const arcTheme = getTheme(this).arc;\n    const {\n      outerRadius = arcTheme.outerRadius,\n      innerRadius = arcTheme.innerRadius,\n      padAngle = arcTheme.padAngle\n    } = this.attribute;\n\n    const { padRadius = sqrt(outerRadius * outerRadius + innerRadius * innerRadius) } = this.attribute;\n    const deltaAngle = abs(endAngle - startAngle);\n\n    // Or is it a circular or annular sector?\n    let outerStartAngle = startAngle;\n    let outerEndAngle = endAngle;\n    let innerStartAngle = startAngle;\n    let innerEndAngle = endAngle;\n    const halfPadAngle = padAngle / 2;\n    let innerDeltaAngle = deltaAngle;\n    let outerDeltaAngle = deltaAngle;\n\n    // Apply padding? Note that since r1 ≥ r0, outerDeltaAngle ≥ innerDeltaAngle.\n    if (halfPadAngle > epsilon && padRadius > epsilon) {\n      const sign = endAngle > startAngle ? 1 : -1;\n\n      let p0 = asin((Number(padRadius) / innerRadius) * sin(halfPadAngle));\n      let p1 = asin((Number(padRadius) / outerRadius) * sin(halfPadAngle));\n      if ((innerDeltaAngle -= p0 * 2) > epsilon) {\n        p0 *= sign;\n        innerStartAngle += p0;\n        innerEndAngle -= p0;\n      } else {\n        innerDeltaAngle = 0;\n        innerStartAngle = innerEndAngle = (startAngle + endAngle) / 2;\n      }\n      if ((outerDeltaAngle -= p1 * 2) > epsilon) {\n        p1 *= sign;\n        outerStartAngle += p1;\n        outerEndAngle -= p1;\n      } else {\n        outerDeltaAngle = 0;\n        outerStartAngle = outerEndAngle = (startAngle + endAngle) / 2;\n      }\n\n      return {\n        outerStartAngle,\n        outerEndAngle,\n        innerStartAngle,\n        innerEndAngle,\n        innerDeltaAngle,\n        outerDeltaAngle\n      };\n    }\n\n    return {\n      outerStartAngle,\n      outerEndAngle,\n      innerStartAngle,\n      innerEndAngle,\n      innerDeltaAngle,\n      outerDeltaAngle\n    };\n  }\n\n  protected doUpdateAABBBounds(full?: boolean): AABBBounds {\n    const arcTheme = getTheme(this).arc;\n    this._AABBBounds.setValue(Infinity, Infinity, -Infinity, -Infinity);\n    const attribute = this.attribute;\n    const bounds = application.graphicService.updateArcAABBBounds(\n      attribute,\n      getTheme(this).arc,\n      this._AABBBounds,\n      full,\n      this\n    ) as AABBBounds;\n\n    const { boundsPadding = arcTheme.boundsPadding } = attribute;\n    const paddingArray = parsePadding(boundsPadding);\n    if (paddingArray) {\n      bounds.expand(paddingArray);\n    }\n    this.clearUpdateBoundTag();\n    return bounds;\n  }\n\n  protected tryUpdateOBBBounds(): OBBBounds {\n    throw new Error('暂不支持');\n  }\n\n  protected needUpdateTags(keys: string[]): boolean {\n    return super.needUpdateTags(keys, ARC_UPDATE_TAG_KEY);\n  }\n  protected needUpdateTag(key: string): boolean {\n    return super.needUpdateTag(key, ARC_UPDATE_TAG_KEY);\n  }\n\n  getDefaultAttribute(name: string) {\n    const arcTheme = getTheme(this).arc;\n    return arcTheme[name];\n  }\n\n  toCustomPath() {\n    const x = 0;\n    const y = 0;\n\n    const attribute = this.attribute;\n    const { startAngle, endAngle } = this.getParsedAngle();\n    let innerRadius = attribute.innerRadius;\n    let outerRadius = attribute.outerRadius;\n    const deltaAngle = abs(endAngle - startAngle);\n    const clockwise: boolean = endAngle > startAngle;\n\n    if (outerRadius < innerRadius) {\n      const temp = outerRadius;\n      outerRadius = innerRadius;\n      innerRadius = temp;\n    }\n\n    const path = new CustomPath2D();\n\n    if (outerRadius <= epsilon) {\n      path.moveTo(x, y);\n    } else if (deltaAngle >= pi2 - epsilon) {\n      // 是个完整的圆环\n      // Or is it a circle or annulus?\n      path.moveTo(x + outerRadius * cos(startAngle), y + outerRadius * sin(startAngle));\n      path.arc(x, y, outerRadius, startAngle, endAngle, !clockwise);\n      if (innerRadius > epsilon) {\n        path.moveTo(x + innerRadius * cos(endAngle), y + innerRadius * sin(endAngle));\n        path.arc(x, y, innerRadius, endAngle, startAngle, clockwise);\n      }\n    } else {\n      const xors = outerRadius * cos(startAngle);\n      const yors = outerRadius * sin(startAngle);\n      const xire = innerRadius * cos(endAngle);\n      const yire = innerRadius * sin(endAngle);\n\n      path.moveTo(x + xors, y + yors);\n      path.arc(x, y, outerRadius, startAngle, endAngle, !clockwise);\n      path.lineTo(x + xire, y + yire);\n      path.arc(x, y, innerRadius, endAngle, startAngle, clockwise);\n      path.closePath();\n    }\n\n    return path;\n  }\n\n  clone() {\n    return new Arc({ ...this.attribute });\n  }\n\n  getNoWorkAnimateAttr(): Record<string, number> {\n    return Arc.NOWORK_ANIMATE_ATTR;\n  }\n}\n\nexport function createArc(attributes: IArcGraphicAttribute): IArc {\n  return new Arc(attributes);\n}\n\n// addAttributeToPrototype(DefaultCircleStyle, Circle, PURE_STYLE_KEY);\n"]}