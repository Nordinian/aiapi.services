"use strict";

Object.defineProperty(exports, "__esModule", {
    value: !0
}), exports.Stack = void 0;

const index_1 = require("../constant/index"), util_1 = require("../util");

class Stack {
    constructor(chart) {
        this.stackRegion = ({model: model}) => {
            const series = model.getSeries();
            if (!series.some((s => s.getStack()))) return;
            const hasTotalLabel = series.some((s => {
                var _a, _b;
                return null === (_b = null === (_a = s.getSpec()) || void 0 === _a ? void 0 : _a.totalLabel) || void 0 === _b ? void 0 : _b.visible;
            })), hasPercent = hasTotalLabel || series.some((s => s.getPercent())), hasOffsetSilhouette = series.some((s => s.getStackOffsetSilhouette())), stackValueGroup = (0, 
            util_1.getRegionStackGroup)(model, !0);
            for (const stackValue in stackValueGroup) for (const key in stackValueGroup[stackValue].nodes) (0, 
            util_1.stack)(stackValueGroup[stackValue].nodes[key], model.getStackInverse(), hasPercent);
            if (hasOffsetSilhouette) for (const stackValue in stackValueGroup) for (const key in stackValueGroup[stackValue].nodes) (0, 
            util_1.stackOffsetSilhouette)(stackValueGroup[stackValue].nodes[key]);
            hasTotalLabel && model.getSeries().forEach((s => {
                const stackData = s.getStackData(), stackValue = s.getStackValue(), stackValueField = s.getStackValueField();
                stackData && stackValueField && (0, util_1.stackTotal)(stackValueGroup[stackValue], stackValueField);
            }));
        }, this._chart = chart;
    }
    init() {
        this._chart.getAllRegions().forEach((r => {
            r.event.on(index_1.ChartEvent.regionSeriesDataFilterOver, {
                filter: ({model: model}) => (null == model ? void 0 : model.id) === r.id
            }, this.stackRegion);
        }));
    }
    stackAll() {
        this._chart.getAllRegions().forEach((r => {
            this.stackRegion({
                model: r
            });
        }));
    }
}

exports.Stack = Stack;
//# sourceMappingURL=stack.js.map