# Gemini 2.5 Pro åˆ†å±‚å®šä»·å®ç°è®°å½•

## æ¦‚è¿°

å®ç°äº† Gemini 2.5 Pro æ¨¡å‹åŸºäºè¾“å…¥tokenæ•°é‡çš„åˆ†å±‚å®šä»·é€»è¾‘ï¼Œè§£å†³äº†ä¸åŒcontext windowä¸‹è®¡è´¹ä¸ä¸€è‡´çš„é—®é¢˜ã€‚

## é—®é¢˜æè¿°

**åŸé—®é¢˜**: Gemini 2.5 Pro åœ¨ä¸åŒçš„context windowï¼ˆä¸åŒæ•°é‡çš„è¾“å…¥è¯å…ƒï¼‰çš„è®¡è´¹æ˜¯ä¸åŒçš„ï¼Œä½†ç°æœ‰ä»£ç é€»è¾‘ä½¿ç”¨å›ºå®šä»·æ ¼ 0.625ï¼Œæ— æ³•å¤„ç†è¿™ç§åˆ†å±‚å®šä»·æƒ…å†µã€‚

**å®˜æ–¹å®šä»·ç»“æ„**:
- **â‰¤200k input tokens**: $1.25/1M tokens input, $10/1M tokens output
- **>200k input tokens**: $2.5/1M tokens input, $15/1M tokens output
- **Batch API**: è¿˜æœ‰ä¸åŒçš„å®šä»·

## å®ç°æ–¹æ¡ˆ

### 1. ä¿®æ”¹ ModelPriceHelper å‡½æ•°

**æ–‡ä»¶**: `/relay/helper/price.go`

**ä¿®æ”¹ä½ç½®**: `ModelPriceHelper` å‡½æ•°ä¸­çš„ä»·æ ¼è®¡ç®—é€»è¾‘

```go
// ç‰¹æ®Šå¤„ç† gemini-2.5-pro çš„åˆ†å±‚å®šä»·
if info.OriginModelName == "gemini-2.5-pro" {
    if promptTokens <= 200000 {
        // â‰¤200k tokens: $1.25/1M tokens input, $10/1M tokens output
        modelRatio = 0.625  // $1.25 / 1M tokens è½¬æ¢ä¸ºç³»ç»Ÿå€ç‡
    } else {
        // >200k tokens: $2.5/1M tokens input, $15/1M tokens output  
        modelRatio = 1.25   // $2.5 / 1M tokens è½¬æ¢ä¸ºç³»ç»Ÿå€ç‡
    }
    success = true
    matchName = info.OriginModelName
}
```

### 2. åŒæ—¶å¤„ç†è¾“å‡ºtokenå€ç‡

**åŒæ–‡ä»¶ä½ç½®**: åœ¨ `completionRatio` è®¡ç®—éƒ¨åˆ†æ·»åŠ ç‰¹æ®Šå¤„ç†

```go
// ç‰¹æ®Šå¤„ç† gemini-2.5-pro çš„è¾“å‡ºtokenå€ç‡
if info.OriginModelName == "gemini-2.5-pro" {
    if promptTokens <= 200000 {
        // â‰¤200k tokens: $10/1M tokens output / $1.25/1M tokens input = 8å€
        completionRatio = 8.0  
    } else {
        // >200k tokens: $15/1M tokens output / $2.5/1M tokens input = 6å€  
        completionRatio = 6.0
    }
}
```

### 3. æ›´æ–°é…ç½®æ–‡ä»¶æ³¨é‡Š

**æ–‡ä»¶**: `/setting/ratio_setting/model_ratio.go`

**ä¿®æ”¹1**: æ›´æ–°åŸºç¡€ä»·æ ¼æ³¨é‡Š
```go
"gemini-2.5-pro": 0.625, // åŸºç¡€ä»·æ ¼ï¼Œå®é™…æ ¹æ®è¾“å…¥tokenæ•°é‡åˆ†å±‚ï¼šâ‰¤200k:0.625, >200k:1.25
```

**ä¿®æ”¹2**: æ›´æ–°å®Œæˆå€ç‡æ³¨é‡Š
```go
} else if strings.HasPrefix(name, "gemini-2.5-pro") { // åŸºç¡€å€ç‡ï¼Œå®é™…æ ¹æ®è¾“å…¥tokenæ•°é‡åŠ¨æ€è®¡ç®—ï¼šâ‰¤200k:8å€, >200k:6å€
    return 8, false
```

## åˆ†å±‚å®šä»·è§„åˆ™

| è¾“å…¥Tokenæ•°é‡ | è¾“å…¥ä»·æ ¼ | è¾“å‡ºä»·æ ¼ | ç³»ç»Ÿå€ç‡ | è¾“å‡ºå€ç‡ | è¯´æ˜ |
|--------------|---------|---------|----------|----------|------|
| â‰¤200k tokens | $1.25/1M | $10/1M | 0.625 | 8.0 | æ ‡å‡†å®šä»·å±‚ |
| >200k tokens | $2.5/1M | $15/1M | 1.25 | 6.0 | é«˜å®¹é‡å®šä»·å±‚ |

## æŠ€æœ¯å®ç°ç»†èŠ‚

### è°ƒç”¨é“¾è·¯

1. **Tokenè®¡ç®—**: `gemini_handler.go` â†’ `getGeminiInputTokens()` â†’ è·å–å®é™…è¾“å…¥tokenæ•°é‡
2. **ä»·æ ¼åˆ†å±‚**: `ModelPriceHelper()` â†’ æ£€æŸ¥æ¨¡å‹åç§°å’Œtokenæ•°é‡ â†’ åŠ¨æ€è®¾ç½®ä»·æ ¼å€ç‡
3. **è´¹ç”¨è®¡ç®—**: ç³»ç»Ÿæ ¹æ®åˆ†å±‚å€ç‡è®¡ç®—å®é™…æ¶ˆè´¹é…é¢

### å…³é”®å‚æ•°

- **`promptTokens`**: è¾“å…¥tokenæ•°é‡ï¼Œç”¨äºåˆ¤æ–­ä»·æ ¼å±‚çº§
- **`modelRatio`**: è¾“å…¥tokenä»·æ ¼å€ç‡
- **`completionRatio`**: è¾“å‡ºtokenç›¸å¯¹äºè¾“å…¥tokençš„å€ç‡

### åˆ¤æ–­é€»è¾‘

```go
if promptTokens <= 200000 {
    // ä½å®¹é‡å±‚ (â‰¤200k tokens)
    modelRatio = 0.625      // $1.25/1M tokens
    completionRatio = 8.0   // $10/1M Ã· $1.25/1M = 8å€
} else {
    // é«˜å®¹é‡å±‚ (>200k tokens)  
    modelRatio = 1.25       // $2.5/1M tokens
    completionRatio = 6.0   // $15/1M Ã· $2.5/1M = 6å€
}
```

## å®ç°ç‰¹ç‚¹

### âœ… ä¼˜åŠ¿

1. **ç²¾ç¡®è®¡è´¹**: ä¸¥æ ¼æŒ‰ç…§ Vertex AI å®˜æ–¹åˆ†å±‚å®šä»·æ‰§è¡Œ
2. **åŠ¨æ€è°ƒæ•´**: å®æ—¶æ ¹æ®è¯·æ±‚çš„è¾“å…¥tokenæ•°é‡ç¡®å®šä»·æ ¼å±‚çº§
3. **å®Œæ•´è¦†ç›–**: åŒæ—¶å¤„ç†è¾“å…¥å’Œè¾“å‡ºtokençš„ä¸åŒä»·æ ¼å€ç‡
4. **å‘åå…¼å®¹**: ä¸å½±å“å…¶ä»–æ¨¡å‹çš„ç°æœ‰å®šä»·é€»è¾‘
5. **å•ä¸€è´£ä»»**: åªå½±å“ `gemini-2.5-pro` æ¨¡å‹

### ğŸ”§ æŠ€æœ¯ä¼˜åŠ¿

1. **æœ€å°ä¾µå…¥**: åœ¨ç°æœ‰æ¶æ„åŸºç¡€ä¸Šæœ€å°åŒ–ä¿®æ”¹
2. **æ€§èƒ½å‹å¥½**: åœ¨ä»·æ ¼è®¡ç®—é˜¶æ®µå¤„ç†ï¼Œæ— é¢å¤–æŸ¥è¯¢å¼€é”€
3. **æ˜“äºç»´æŠ¤**: é€»è¾‘é›†ä¸­åœ¨ `ModelPriceHelper` å‡½æ•°ä¸­
4. **æ‰©å±•æ€§å¼º**: å¦‚éœ€æ·»åŠ å…¶ä»–åˆ†å±‚å®šä»·æ¨¡å‹ï¼Œå¯å¤ç”¨ç›¸åŒæ¨¡å¼

## æµ‹è¯•éªŒè¯

### ç¼–è¯‘æµ‹è¯•
```bash
# éªŒè¯ price.go æ–‡ä»¶ç¼–è¯‘
go build -o /dev/null ./relay/helper/

# éªŒè¯æ•´ä¸ªé¡¹ç›®ç¼–è¯‘  
go build -o /dev/null .
```

**ç»“æœ**: âœ… ç¼–è¯‘æˆåŠŸï¼Œæ— é”™è¯¯

### åŠŸèƒ½æµ‹è¯•åœºæ™¯

**åœºæ™¯1**: å°å®¹é‡è¯·æ±‚ (â‰¤200k tokens)
- **è¾“å…¥**: 100k tokens
- **é¢„æœŸ**: modelRatio=0.625, completionRatio=8.0

**åœºæ™¯2**: å¤§å®¹é‡è¯·æ±‚ (>200k tokens)
- **è¾“å…¥**: 300k tokens  
- **é¢„æœŸ**: modelRatio=1.25, completionRatio=6.0

**åœºæ™¯3**: è¾¹ç•Œå€¼æµ‹è¯•
- **è¾“å…¥**: 200000 tokens (è¾¹ç•Œå€¼)
- **é¢„æœŸ**: modelRatio=0.625, completionRatio=8.0

## ç›¸å…³æ–‡ä»¶

### ä¸»è¦ä¿®æ”¹æ–‡ä»¶
1. `/relay/helper/price.go` - æ ¸å¿ƒåˆ†å±‚å®šä»·é€»è¾‘
2. `/setting/ratio_setting/model_ratio.go` - é…ç½®æ³¨é‡Šæ›´æ–°

### ç›¸å…³ä¾èµ–æ–‡ä»¶
1. `/relay/gemini_handler.go` - Tokenè®¡ç®—å’Œä»·æ ¼è°ƒç”¨
2. `/relay/common/relay_info.go` - RelayInfoç»“æ„ä½“å®šä¹‰

## å®˜æ–¹æ–‡æ¡£å‚è€ƒ

- **Vertex AI Gemini APIå®šä»·**: https://cloud.google.com/vertex-ai/generative-ai/pricing
- **Gemini 2.5 Proå®˜æ–¹å®šä»·è¡¨**: https://cloud.google.com/vertex-ai/generative-ai/docs/partner-models/use-gemini

## åç»­æ”¹è¿›å»ºè®®

### 1. ç›‘æ§å’Œæ—¥å¿—
- æ·»åŠ åˆ†å±‚å®šä»·å†³ç­–çš„æ—¥å¿—è®°å½•
- ç›‘æ§ä¸åŒä»·æ ¼å±‚çº§çš„ä½¿ç”¨åˆ†å¸ƒ

### 2. Batch APIæ”¯æŒ
- è€ƒè™‘æ·»åŠ  Batch API çš„ä¸åŒå®šä»·æ”¯æŒ
- æ‰©å±•åˆ†å±‚å®šä»·é€»è¾‘ä»¥æ”¯æŒæ›´å¤šä»·æ ¼å˜ä½“

### 3. é…ç½®åŒ–
- è€ƒè™‘å°†åˆ†å±‚é˜ˆå€¼ (200k) å’Œä»·æ ¼å€ç‡è®¾ä¸ºå¯é…ç½®å‚æ•°
- æ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶åŠ¨æ€è°ƒæ•´åˆ†å±‚ç­–ç•¥

### 4. å…¶ä»–æ¨¡å‹æ‰©å±•
- ä¸ºå…¶ä»–å¯èƒ½éœ€è¦åˆ†å±‚å®šä»·çš„æ¨¡å‹æä¾›ç›¸åŒæ”¯æŒ
- å»ºç«‹é€šç”¨çš„åˆ†å±‚å®šä»·æ¡†æ¶

## ç‰ˆæœ¬ä¿¡æ¯

- **å®ç°æ—¥æœŸ**: 2025-01-02
- **å½±å“ç‰ˆæœ¬**: aiapi.services-alpha
- **å‘åå…¼å®¹**: æ˜¯
- **ç ´åæ€§å˜æ›´**: æ— 

## æ€»ç»“

æˆåŠŸå®ç°äº† Gemini 2.5 Pro çš„å®˜æ–¹åˆ†å±‚å®šä»·é€»è¾‘ï¼Œè§£å†³äº†ä¸åŒcontext windowä¸‹è®¡è´¹ä¸å‡†ç¡®çš„é—®é¢˜ã€‚å®ç°æ–¹æ¡ˆå…·æœ‰è‰¯å¥½çš„æ‰©å±•æ€§å’Œç»´æŠ¤æ€§ï¼Œä¸ºåç»­å…¶ä»–æ¨¡å‹çš„åˆ†å±‚å®šä»·éœ€æ±‚å¥ å®šäº†åŸºç¡€ã€‚